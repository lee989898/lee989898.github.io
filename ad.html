<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Room</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->

    <!-- custom.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/custom.css" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- 웹 폰트 -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothic.css">

    <!-- syntax.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="공부 블로그" />
    <link rel="shortcut icon" href="https://lee989898.github.io/assets/built/images/favicon.jpg" type="image/png" />
    <link rel="canonical" href="https://lee989898.github.io/ad" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

    
    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    TeX: {
      equationNumbers: {
        autoNumber: "AMS"
      }
    },
    tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$'] ],
    processEscapes: true,
  }
});
MathJax.Hub.Register.MessageHook("Math Processing Error",function (message) {
	  alert("Math Processing Error: "+message[1]);
	});
MathJax.Hub.Register.MessageHook("TeX Jax - parse error",function (message) {
	  alert("Math Processing Error: "+message[1]);
	});
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

    


     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="LEE" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Room" />
    <meta property="og:description" content="모바일 애플리케이션에 사용하는 SQLite는 SQL 데이터베이스 엔진이다. 수백만 개의 안드로이드 및 IOS 애플리케이션이 있어서 SQLite는 세계에서 가장 많이 사용되는 데이터베이스 엔진으로 간주된다 옛날 부터 안드로이드는 SQLite를 사용해 왔는데 SQLite와 함께 작동하는 코드 작성은 시간이 많이 걸리고 매우 어려운 작업이고 보일러 플레이트 코드를 반복해서 작성해야 했다 그러나 다행스럽게도 2017년에 Room data" />
    <meta property="og:url" content="https://lee989898.github.io/ad" />
    <meta property="og:image" content="https://lee989898.github.io/assets/built/images/android-logo.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2022-04-22T16:07:07+09:00" />
    <meta property="article:modified_time" content="2022-04-22T16:07:07+09:00" />
    <meta property="article:tag" content="Android" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Room" />
    <meta name="twitter:description" content="모바일 애플리케이션에 사용하는 SQLite는 SQL 데이터베이스 엔진이다. 수백만 개의 안드로이드 및 IOS 애플리케이션이 있어서 SQLite는 세계에서 가장 많이 사용되는 데이터베이스 엔진으로 간주된다 옛날 부터 안드로이드는 SQLite를 사용해 왔는데 SQLite와 함께 작동하는 코드 작성은 시간이 많이 걸리고 매우 어려운 작업이고 보일러 플레이트 코드를 반복해서 작성해야 했다 그러나 다행스럽게도 2017년에 Room data" />
    <meta name="twitter:url" content="https://lee989898.github.io/" />
    <meta name="twitter:image" content="https://lee989898.github.io/assets/built/images/android-logo.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="LEE" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Android" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "LEE",
        "logo": "https://lee989898.github.io/"
    },
    "url": "https://lee989898.github.io/ad",
    "image": {
        "@type": "ImageObject",
        "url": "https://lee989898.github.io/assets/built/images/android-logo.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://lee989898.github.io/ad"
    },
    "description": "모바일 애플리케이션에 사용하는 SQLite는 SQL 데이터베이스 엔진이다. 수백만 개의 안드로이드 및 IOS 애플리케이션이 있어서 SQLite는 세계에서 가장 많이 사용되는 데이터베이스 엔진으로 간주된다 옛날 부터 안드로이드는 SQLite를 사용해 왔는데 SQLite와 함께 작동하는 코드 작성은 시간이 많이 걸리고 매우 어려운 작업이고 보일러 플레이트 코드를 반복해서 작성해야 했다 그러나 다행스럽게도 2017년에 Room data"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Room" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://lee989898.github.io/">LEE</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-kotlin" role="menuitem"><a href="/tag/kotlin/">코틀린</a></li>
    <li class="nav-algorithm" role="menuitem"><a href="/tag/algorithm/">알고리즘</a></li>
    <li class="nav-pl" role="menuitem"><a href="/tag/pl/">프로그래밍언어</a></li>
    <li class="nav-android" role="menuitem"><a href="/tag/android/">안드로이드</a></li>
    <li class="nav-security" role="menuitem"><a href="/tag/security/">컴퓨터보안</a></li>
    <li class="nav-system" role="menuitem"><a href="/tag/system/">시스템프로그래밍</a></li>
    <li class="nav-systemcloud" role="menuitem"><a href="/tag/systemcloud/">시스템클라우드보안</a></li>
    <li class="nav-blockchain" role="menuitem"><a href="/tag/blockchain/">블록체인</a></li>
    <li class="nav-archive" role="menuitem">
        
        <a href="/archive.html">All Posts</a>
    </li>
    <li class="nav-archive" role="menuitem">
        <a href="/author_archive.html">Tag별 Posts</a>
    </li>


</ul>



        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Search</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-android post tag-android ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="22 April 2022">22 April 2022</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/android/'>ANDROID</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Room</h1>
            </header>

            <!--
            
            <figure class="post-full-image" style="background-image: url(/assets/built/images/android-logo.png)">
            </figure>
            
            -->
            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>모바일 애플리케이션에 사용하는 SQLite는 SQL 데이터베이스 엔진이다. 수백만 개의 안드로이드 및 IOS 애플리케이션이 있어서 SQLite는 세계에서 가장 많이 사용되는 데이터베이스 엔진으로 간주된다<br />
옛날 부터 안드로이드는 SQLite를 사용해 왔는데 SQLite와 함께 작동하는 코드 작성은 시간이 많이 걸리고 매우 어려운 작업이고 보일러 플레이트 코드를 반복해서 작성해야 했다</p>

<p>그러나 다행스럽게도 2017년에 Room data 라이브러리가 도입되었다. 공식 문서에 따르면 Room은 SQLite를 통해 추상화 계층을 제공하여 능숙한 데이터베이스 액세스를 허용한다. Room 라이브러리가 하는 일은 백그라운드에서 많은 코드를 생성하는 것이다</p>

<p>Room annotation을 사용하여 Room 라이브러리에 정보를 제공한다. annotation을 고려하여 Room 작업에 필요한 코드 생성한다. 프로젝트에서 Room data 라이브러리를 사용하려고 할 때 3가지 유형의 Room 클래스를 생성해야 한다</p>

<ol>
  <li>Room database 클래스 실제 sqlite 데이터베이스를 나타냄</li>
  <li>Entitiy 클래스 해당 데이터베이스의 테이블을 나타냄</li>
  <li>DAO 인터페이스, 데이터 액세스 개체 인터페이스를 만들어야 한다. 즉, 데이터베이스에 액세스하는 데 사용되는 메서드를 포함하는 DAO 인터페이스이다</li>
</ol>

<hr />

<p>프로젝트를 시작하기 전에 데이터 바인딩을 활성화 하고 ViewModel, LiveData, kapt(kotlin 주석 프로세서), Room, Coroutine dependency를 추가해야한다</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// build.gradle</span>
<span class="nf">buildFeatures</span><span class="p">{</span>
        <span class="n">dataBinding</span> <span class="k">true</span>
    <span class="p">}</span>

<span class="nf">dependencies</span> <span class="p">{</span>
    <span class="n">def</span> <span class="n">lifecycle_version</span> <span class="p">=</span> <span class="s">"2.5.0-alpha06"</span>
    <span class="n">def</span> <span class="n">room_version</span> <span class="p">=</span> <span class="s">"2.4.2"</span>

    <span class="c1">// optional - RxJava2 support for Room</span>
    <span class="n">implementation</span> <span class="s">"androidx.room:room-rxjava2:$room_version"</span>
    <span class="n">implementation</span> <span class="s">"androidx.room:room-runtime:$room_version"</span>
    <span class="n">kapt</span> <span class="s">"androidx.room:room-compiler:$room_version"</span>

    <span class="c1">// ViewModel</span>
    <span class="n">implementation</span> <span class="s">"androidx.lifecycle:lifecycle-viewmodel-ktx:$lifecycle_version"</span>
    <span class="c1">// LiveData</span>
    <span class="n">implementation</span> <span class="s">"androidx.lifecycle:lifecycle-livedata-ktx:$lifecycle_version"</span>
    <span class="n">kapt</span> <span class="s">"androidx.lifecycle:lifecycle-compiler:$lifecycle_version"</span>

    <span class="c1">// Coroutine</span>
    <span class="n">implementation</span> <span class="err">'</span><span class="n">org</span><span class="p">.</span><span class="n">jetbrains</span><span class="p">.</span><span class="n">kotlinx</span><span class="p">:</span><span class="n">kotlinx-coroutines-android</span><span class="p">:</span><span class="mf">1.3.9</span><span class="err">'</span>
    <span class="n">implementation</span> <span class="err">'</span><span class="n">org</span><span class="p">.</span><span class="n">jetbrains</span><span class="p">.</span><span class="n">kotlinx</span><span class="p">:</span><span class="n">kotlinx-coroutines-core</span><span class="p">:</span><span class="mf">1.3.9</span>
<span class="p">}</span>
</code></pre></div></div>

<p>데이터베이스에 테이블을 생성해야 한다. 테이블 이름은 Subscriber_data_table 이고 subscriberId, name, email 3개의 열이 있다. SubscriberId는 기본 키이다<br />
Room 라이브러리는 “@Entity”로 주석이 달린 각 클래스에 대한 테이블을 생성한다. 클래스의 이름을 Subscriber로 지정한다
여기에서 Room에게 제공할 데이터베이스 테이블 이름을 정할 수 있다. 이름을 지정하지 않으면 Room은 클래스 이름 “Subscriber”를 테이블로 사용한다. “@ColumnInfo” 주석을 사용하여 테이블에서 해당 열의 이름을 지정할 수도 있다. 멤버 변수의 이름과 다르게 하려면. 데이터베이스에 별도의 이름을 지정한다<br />
데이터 클래스의 이름을 사용하는 것보다 모범 사례이다. 더 큰 프로젝트에서 다른 작업 및 다른 라이브러리에 이 동일한 데이터 클래스를 사용해야 하기 때문이다
다음으로 이 데이터베이스 테이블에 대한 기본 키를 지정해야 한다. 이 SubscriberId 필드에 “@PrimaryKey” 주석을 추가하여 기본 키를 설정할 수 있다<br />
이 기본 키가 자동 생성되기를 원하면 autoGenerate 속성을 true로 설정한다<br />
Room 데이터베이스에 대한 Entity 클래스를 만드는 방법이다</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span><span class="p">(</span><span class="n">tableName</span> <span class="p">=</span> <span class="s">"subscriber_data_table"</span><span class="p">)</span>
<span class="kd">data class</span> <span class="nc">Subscriber</span><span class="p">(</span>

    <span class="nd">@PrimaryKey</span><span class="p">(</span><span class="n">autoGenerate</span> <span class="p">=</span> <span class="k">true</span><span class="p">)</span>
    <span class="nd">@ColumnInfo</span><span class="p">(</span><span class="n">name</span> <span class="p">=</span> <span class="s">"subscriber_name"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">id</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>

    <span class="nd">@ColumnInfo</span><span class="p">(</span><span class="n">name</span> <span class="p">=</span> <span class="s">"subscriber_id"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>

    <span class="nd">@ColumnInfo</span><span class="p">(</span><span class="n">name</span> <span class="p">=</span> <span class="s">"subscriber_email"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">email</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Data access object 인터페이스 또는 DAO 인터페이스는 데이터베이스에 액세스하는 기능을 정의하는 곳이다<br />
sqlite를 직접 사용했을 때, 더 큰 데이터베이스 쿼리를 별도의 파일에 작성해야 했다. 커서 개체를 사용하려면 복잡한 코드 논리를 작성해야 했다</p>

<p>Room이 모든 힘든 일을 한다. 제공하는 정보를 읽고 annotations를 사용한다<br />
SubscriberDAO라고 하는 새로운 인터페이스를 만들겠다. 그리고 @Dao로 annotations을 단다
Room은 이 @Dao 주석을 본 후 이 인터페이스를 DAO 인터페이스로 인식한다</p>

<p>이제 Subscriber 객체를 데이터베이스에 삽입하는 함수를 작성해 보겠다<br />
“@Insert” 주석을 사용한다. 여기에 함수 이름을 insert로 썼다. 이 이름은 중요하지 않다<br />
원하는 의미 있는 이름을 제공할 수 있다. 가장 중요한 것은 이 “@Insert” 주석이다. 룸 라이브러리는 다음을 읽어서 이 기능을 인식하여 데이터베이스에 Subscribe 객체를 삽입해야 하는것이 그리고 Room은 백그라운드에서 필요한 코드를 생성한다</p>

<p>suspend 가 있는 이유는 Room은 메인 스레드에서 데이터베이스 액세스를 지원하지 않아서 오랜 시간 동안 UI를 잠글 수 있기 때문이다<br />
따라서 백그라운드 스레드에서 이러한 기능을 실행해야 한다. 이를 위해 비동기 작업을 사용할 수 있다<br />
그러나 가장 발전되고 가장 쉽고 효율적인 방법은 Kotlin 코루틴이다. Room이 직접 제공하기 때문에 Kotlin 코루틴 지원, room은 이러한 기능을 suspend 기능으로 작성할 수 있도록 한다<br />
suspend 와 함께. suspend 기능은 단순히 다음 시간에 suspend 했다가 다시 시작할 수 있는 기능이다</p>

<p>이제 어떻게든 코루틴을 사용하지 않기로 결정했다면 suspend 없이 함수를 작성할 수 있다. 호출 클래스에서 다른 백그라운드 처리 방법을 사용하는 경우에도 작동한다</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Dao</span>
<span class="kd">interface</span> <span class="nc">SubscriberDAO</span> <span class="p">{</span>

    <span class="nd">@Insert</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">insertSubscriber</span><span class="p">(</span><span class="n">subscriber</span><span class="p">:</span> <span class="nc">Subscriber</span><span class="p">):</span> <span class="nc">Long</span>

    <span class="nd">@Insert</span>
    <span class="k">fun</span> <span class="nf">insertSubscriber2</span><span class="p">(</span><span class="n">subscriber</span><span class="p">:</span> <span class="nc">Subscriber</span><span class="p">):</span> <span class="nc">Long</span>

    <span class="nd">@Insert</span>
    <span class="k">fun</span> <span class="nf">insertSubscriber3</span><span class="p">(</span><span class="n">subscriber1</span><span class="p">:</span> <span class="nc">Subscriber</span><span class="p">,</span> <span class="n">subscriber2</span><span class="p">:</span> <span class="nc">Subscriber</span><span class="p">,</span> <span class="n">subscriber3</span><span class="p">:</span> <span class="nc">Subscriber</span><span class="p">):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Long</span><span class="p">&gt;</span>

    <span class="nd">@Insert</span>
    <span class="k">fun</span> <span class="nf">insertSubscriber4</span><span class="p">(</span><span class="n">subscribers</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Subscriber</span><span class="p">&gt;):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Long</span><span class="p">&gt;</span>

    <span class="nd">@Insert</span>
    <span class="k">fun</span> <span class="nf">insertSubscriber5</span><span class="p">(</span><span class="n">subscriber</span><span class="p">:</span> <span class="nc">Subscriber</span><span class="p">,</span> <span class="n">subscribers</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Subscriber</span><span class="p">&gt;):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Long</span><span class="p">&gt;</span>   
<span class="p">}</span>
</code></pre></div></div>

<p>insert 함수의 다른 버전도 가능하다</p>

<p>확인을 위해 반환 값을 얻어야 할 수도 있다. 실제로 새로운 rowId 또는 rowIds를 type의 반환 값으로 얻을 수 있다. 유형은 long이거나 배열이거나 긴 값 목록이어야 한다</p>

<p>OnConflictStrategy는 또 다른 중요한 속성이다. 우리는 이러한 기능을 설정할 수 있습니다<br />
OnConflictStrategy.REPLACE, 엔티티 삽입을 시도한다. 동일한 ID 값을 가진 기존 행이 있는 경우 이전 엔터티를 삭제하고 대체한다<br />
IGNORE로 설정하면 충돌을 무시한다</p>

<p>Subscriber_data_table 의 행을 업데이트한다. 함수 매개변수는 구독자 개체의 인스턴스여야 한다</p>

<p>@Update 어노테이션으로 이것을 어노테이션하는 것이 가장 중요하다. 함수 이름은 중요하지 않다<br />
전체 목록을 업데이트하는 매개변수로 구독자 목록을 추가하여 이 함수를 작성할 수도 있다<br />
int 반환 유형 작성할 수 있다. 데이터베이스에서 업데이트된 행 수를 반환한다</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SubscriberDAO</span>
<span class="nd">@Update</span>
<span class="k">suspend</span> <span class="k">fun</span> <span class="nf">updateSubscriber</span><span class="p">(</span><span class="n">subscriber</span><span class="p">:</span> <span class="nc">Subscriber</span><span class="p">)</span>
</code></pre></div></div>

<p>이제 구독자를 삭제하는 함수를 정의해 보겠다. “@Delete” 주석으로 여기에 주석을 추가한다. 삭제 기능도 다른 변형을 가질 수도 있다. 하나 이상의 엔터티를 매개변수로 추가할 수 있다. 엔티티 목록을 매개변수로 추가할 수도 있다. 이 삭제 함수는 int를 반환할 수도 있다. 값은 삭제된 행 수이다</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SubscriberDAO</span>
<span class="nd">@Delete</span>
<span class="k">suspend</span> <span class="k">fun</span> <span class="nf">deleteSubscriber</span><span class="p">(</span><span class="n">subscriber</span><span class="p">:</span> <span class="nc">Subscriber</span><span class="p">)</span>
</code></pre></div></div>

<p>이제 @Query 주석을 사용하여 room을 사용하면 함수가 실행될 때 실행할 SQL 쿼리를 포함할 수 있다<br />
가장 중요한 것은 이 쿼리가 컴파일 시간에 Room에서 확인되어 데이터베이스와 잘 작동하는지 확인하는 것이다
그래서 런타임 오류와 관련된 데이터베이스 쿼리가 없다. 이것이 주요 이점이다</p>

<p>테이블에서 모든 행을 삭제하는 함수를 만들어 보겠다<br />
그런 다음 @Query 주석으로 이를 주석 처리한다. 그런 다음 SQL 쿼리 DELETE에 subscriber_data_table</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SubscriberDAO</span>
<span class="nd">@Query</span><span class="p">(</span><span class="s">"DELETE FROM subscriber_data_table"</span><span class="p">)</span>
<span class="k">suspend</span> <span class="k">fun</span> <span class="nf">deleteAll</span><span class="p">()</span>
</code></pre></div></div>

<p>다음으로 subscriber_data_table에서 모든 데이터를 가져오는 함수를 작성해보겠다<br />
Room을 사용하면 데이터베이스 테이블에서 엔티티 목록의 라이브 데이터로 데이터를 쉽게 얻을 수 있다<br />
이러한 쿼리를 비동기 쿼리라고 한다. LiveData를 반환 값으로 갖기 때문이다. 백그라운드 스레드에서 단독으로 실행된다<br />
따라서 백그라운드 스레드에서 실행하기 위해 특별한 코드를 작성할 필요가 없다. 따라서 이러한 기능을 실행하기 위해 코루틴, AsyncTask 또는 Excutor를 사용할 필요가 없다</p>

<p>라이브 데이터로 데이터베이스에서 모든 구독자 엔터티 목록을 가져오는 함수를 작성한다<br />
구독자 목록의 LiveData를 반환한다<br />
그런 다음 @Query SELECT * FROM ubscriber_data_table</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Query</span><span class="p">(</span><span class="s">"SELECT * FROM subscriber_data_table"</span><span class="p">)</span>
<span class="k">fun</span> <span class="nf">getAllSubscribers</span><span class="p">():</span> <span class="nc">LiveData</span><span class="p">&lt;</span><span class="nc">List</span><span class="p">&lt;</span><span class="nc">Subscriber</span><span class="p">&gt;&gt;</span>
</code></pre></div></div>

<p>이 함수와 그전에 정의한 다른 함수의 차이점은 무엇인가요? suspend를 추가하지 않았다<br />
코루틴을 사용하여 백그라운드 스레드에서 이 함수를 실행할 필요가 없기 때문이다. Room 라이브러리는 백그라운드 스레드에서 작업을 수행한다</p>

<hr />

<p>앱의 실제 데이터베이스를 나타내기 위해 absctract 클래스를 만든다. abstract이고 RoomDatabase를 상속받아야 한다. 그리고 @Database로 annotation을 달아야 한다. entity 클래스 목록을 제공해야 한다. 그 다음 데이터베이스의 버전 번호를 추가한다 버전 번호는 데이터베이스를 한 버전에서 다른 버전으로 마이그레이션할 때 중요하다</p>

<p>그런 다음 DAO 인터페이스에 대한 추상 참조를 선언해야 한다. 작은 프로젝트여서 하나의 엔티티 클래스와 해당 DAO 인터페이스만 가지고 있는데 엔티티 클래스가 더 많았다면 여기에 모두 나열하고 해당 클래스에 대한 참조를 정의하면된다</p>

<p>새 개체를 만들고 프로젝트의 다른 위치에서 이 데이터베이스 클래스를 사용할 수 있다. 하지만 좋은 방법은 아니다. 예기치 않은 오류를 방지하려면 일반적으로 전체 앱에 대해 하나의 Room 데이터베이스 인스턴스만 사용해야 한다. 그리고 성능 문제가 있는 경우 여러 데이터베이스 인스턴스가 동시에 열리도록 해서는 안 된다. 따라서 여기에서 싱글톤을 생성해야 한다<br />
@Volatile annotation 처리한다. Volatile annotation은 필드를 즉시 다른 스레드에서 볼 수 있도록 한다. 상용구라 이 코드 부분을 복사하여 모든 Room에 붙여넣을 수 있다. 데이터베이스 클래스를 변경하고 클래스 이름과 데이터베이스 이름을 변경하면 된다</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SubscriberDatabase.kt</span>
<span class="nd">@Database</span><span class="p">(</span><span class="n">entities</span> <span class="p">=</span> <span class="p">[</span><span class="nc">Subscriber</span><span class="o">::</span><span class="k">class</span><span class="p">],</span> <span class="n">version</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">exportSchema</span> <span class="p">=</span> <span class="k">false</span><span class="p">)</span>
<span class="k">abstract</span> <span class="kd">class</span> <span class="nc">SubscriberDatabase</span> <span class="p">:</span> <span class="nc">RoomDatabase</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">abstract</span> <span class="kd">val</span> <span class="py">subscriberDao</span><span class="p">:</span> <span class="nc">SubscriberDAO</span>

    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="nd">@Volatile</span>
        <span class="k">private</span> <span class="kd">var</span> <span class="py">INSTANCE</span><span class="p">:</span> <span class="nc">SubscriberDatabase</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
        <span class="k">fun</span> <span class="nf">getInstance</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">):</span> <span class="nc">SubscriberDatabase</span> <span class="p">{</span>
            <span class="nf">synchronized</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="py">instance</span> <span class="p">=</span> <span class="nc">INSTANCE</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">instance</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">instance</span> <span class="p">=</span> <span class="nc">Room</span><span class="p">.</span><span class="nf">databaseBuilder</span><span class="p">(</span>
                        <span class="n">context</span><span class="p">.</span><span class="n">applicationContext</span><span class="p">,</span>
                        <span class="nc">SubscriberDatabase</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">,</span>
                        <span class="s">"subscriber_data_database"</span>
                    <span class="p">).</span><span class="nf">build</span><span class="p">()</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="n">instance</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>

<hr />

<p>MVVM을 따라서 해보자. 모델은 모든 데이터 관리 관련 구성 요소를 의미한다<br />
모델에는 로컬 데이터베이스 관련 구성 요소, 원격 데이터 소스 관련 구성 요소 및 저장소가 있다. 여기서는 원격 데이터 소스를 사용하지 않을 것이다</p>

<p>이 부분을 완료하는 엔터티 클래스, DAO 인터페이스 및 데이터베이스 클래스를 이미 만들었다</p>

<p>프로젝트에 대한 저장소 클래스를 만들자. 리포지토리 클래스의 목적은 뷰 모델이 데이터를 쉽게 가져오고 보낼 수 있는 깨끗한 API를 제공하는 것이다<br />
Google 문서에서 알 수 있듯이 리포지토리를 서로 다른 데이터 소스 간의 중재자로 생각할 수 있다. 로컬 데이터베이스, 웹 서비스 및 캐시와 같은 우리의 간단한 프로젝트에는 로컬 데이터베이스만 있다</p>

<p>이것을 SubscriberRepository로 명명한다. 이 클래스의 생성자 매개변수로 SubscriberDAO 인터페이스의 인스턴스를 추가하고 있다. 왜냐하면 리포지토리에서 DAO의 기능을 호출할 것이기 때문이다<br />
먼저 subscribers 목록의 라이브 데이터에 대한 변수를 정의하고 있다. 이것은 dao.getAllSubscribers() 여야 한다. 백그라운드 스레드에서 이 getAllSubscribers 함수를 호출할 필요는 없다. 룸 라이브러리가 백그라운드 스레드에서 라이브 데이터를 반환 유형으로 사용하여 이러한 함수를 자동으로 처리한다</p>

<p>다른 모든 DAO 함수는 백그라운드 스레드에서 호출해야 한다. 뷰 모델 클래스에서 코루틴을 사용하여 실행한다. 하지만 이를 지원하려면 이러한 기능을 suspend 함스로 정의한다. subscriber 데이터를 삽입하는 함수를 만들어 보자</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SubscriberRepository.kt</span>
<span class="kd">class</span> <span class="nc">SubscriberRepository</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">dao</span><span class="p">:</span> <span class="nc">SubscriberDAO</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">val</span> <span class="py">subscribers</span> <span class="p">=</span> <span class="n">dao</span><span class="p">.</span><span class="nf">getAllSubscribers</span><span class="p">()</span>

    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">insert</span><span class="p">(</span><span class="n">subscriber</span><span class="p">:</span> <span class="nc">Subscriber</span><span class="p">){</span>
        <span class="n">dao</span><span class="p">.</span><span class="nf">insertSubscriber</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">update</span><span class="p">(</span><span class="n">subscriber</span><span class="p">:</span> <span class="nc">Subscriber</span><span class="p">){</span>
        <span class="n">dao</span><span class="p">.</span><span class="nf">updateSubscriber</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">delete</span><span class="p">(</span><span class="n">subscriber</span><span class="p">:</span> <span class="nc">Subscriber</span><span class="p">){</span>
        <span class="n">dao</span><span class="p">.</span><span class="nf">deleteSubscriber</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">deleteAll</span><span class="p">(){</span>
        <span class="n">dao</span><span class="p">.</span><span class="nf">deleteAll</span><span class="p">()</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>

<hr />

<blockquote>
  <p>ViewModel</p>
</blockquote>

<p>이제 뷰 모델 클래스의 다른 기능을 완성해 보자. subscriber 목록을 라이브 데이터로 가져온다<br />
repository의 구독자 변수를 호출할 수 있다</p>

<p>subscriber를 insert하는 함수를 만들어 보자. 여기에서 subscriber 인스턴스를 전달하는 repository의 insert 기능을 호출할 수 있다. 우리가 논의한 바와 같이
이전에는 백그라운드 스레드에서 이 함수 호출을 수행해야 하는데 이를 위해 viewModelScope.launch를 사용할 수 있다
이제 update, delete 및 deleteAll를 위한 유사한 기능을 만들어 보겠다</p>

<p>기본 키 subscriber ID를 autogenerate로 설정했기 때문에 다음과 같이 0을 추가할 수 있다. 모든 구독자 엔터티의 ID이다. Room은 이를 무시하고 autogenerate 값을 추가한다</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SubscriberViewModel.kt</span>
<span class="kd">class</span> <span class="nc">SubscriberViewModel</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">repository</span><span class="p">:</span> <span class="nc">SubscriberRepository</span><span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>

    <span class="kd">val</span> <span class="py">inputName</span> <span class="p">=</span> <span class="nc">MutableLiveData</span><span class="p">&lt;</span><span class="nc">String</span><span class="err">?</span><span class="p">&gt;()</span>
    <span class="kd">val</span> <span class="py">inputEmail</span> <span class="p">=</span> <span class="nc">MutableLiveData</span><span class="p">&lt;</span><span class="nc">String</span><span class="err">?</span><span class="p">&gt;()</span>

    <span class="kd">val</span> <span class="py">saveOrUpdateButtonText</span> <span class="p">=</span> <span class="nc">MutableLiveData</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;()</span>
    <span class="kd">val</span> <span class="py">clearAllOrDeleteButtonText</span> <span class="p">=</span> <span class="nc">MutableLiveData</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;()</span>

    <span class="nf">init</span> <span class="p">{</span>
        <span class="n">saveOrUpdateButtonText</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="s">"Save"</span>
        <span class="n">clearAllOrDeleteButtonText</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="s">"Clear All"</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">saveOrUpdate</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">name</span> <span class="p">=</span> <span class="n">inputName</span><span class="p">.</span><span class="n">value</span><span class="o">!!</span>
        <span class="kd">val</span> <span class="py">email</span> <span class="p">=</span> <span class="n">inputEmail</span><span class="p">.</span><span class="n">value</span><span class="o">!!</span>
        <span class="nf">insert</span><span class="p">(</span><span class="nc">Subscriber</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="p">))</span>
        <span class="n">inputName</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="k">null</span>
        <span class="n">inputEmail</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="k">null</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">clearAllOrDelete</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">clearAll</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">insert</span><span class="p">(</span><span class="n">subscriber</span><span class="p">:</span> <span class="nc">Subscriber</span><span class="p">)</span> <span class="p">=</span>
        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="n">repository</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">update</span><span class="p">(</span><span class="n">subscriber</span><span class="p">:</span> <span class="nc">Subscriber</span><span class="p">)</span> <span class="p">=</span>
        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="n">repository</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">delete</span><span class="p">(</span><span class="n">subscriber</span><span class="p">:</span> <span class="nc">Subscriber</span><span class="p">)</span> <span class="p">=</span>
        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="n">repository</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">clearAll</span><span class="p">()</span> <span class="p">=</span> <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
        <span class="n">repository</span><span class="p">.</span><span class="nf">deleteAll</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">getSaveSubscribers</span><span class="p">()</span> <span class="p">=</span> <span class="nf">liveData</span> <span class="p">{</span>
        <span class="n">repository</span><span class="p">.</span><span class="n">subscribers</span><span class="p">.</span><span class="nf">collect</span> <span class="p">{</span>
            <span class="nf">emit</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>

<p>뷰 모델에는 생성자 매개변수가 있으므로 뷰 모델 팩토리 클래스를 생성해야 한다<br />
viewmodel 클래스에는 생성자 매개변수로 SubscriberRepository의 인스턴스가 있으므로 이 팩토리는 클래스에도 생성자 매개변수로 SubscriberRepository의 인스턴스가 있어야 한다. 아래 코드 부분은 모든 뷰 모델 팩토리에 사용하는 상용구 코드이다</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SubscriberViewModelFactory.kt</span>
<span class="kd">class</span> <span class="nc">SubscriberViewModelFactory</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">repository</span><span class="p">:</span> <span class="nc">SubscriberRepository</span><span class="p">):</span> <span class="nc">ViewModelProvider</span><span class="p">.</span><span class="nc">Factory</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">T</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">&gt;</span> <span class="nf">create</span><span class="p">(</span><span class="n">modelClass</span><span class="p">:</span> <span class="nc">Class</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;):</span> <span class="nc">T</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">modelClass</span><span class="p">.</span><span class="nf">isAssignableFrom</span><span class="p">(</span><span class="nc">SubscriberViewModel</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)){</span>
            <span class="k">return</span> <span class="nc">SubscriberViewModel</span><span class="p">(</span><span class="n">repository</span><span class="p">)</span> <span class="k">as</span> <span class="nc">T</span>
        <span class="p">}</span>
        <span class="k">throw</span> <span class="nc">IllegalArgumentException</span><span class="p">(</span><span class="s">"Unknown View Model class"</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>

<p>이제 MainActivity로 이동하여 뷰 모델을 사용하는 코드를 작성해 보자</p>

<p>먼저 데이터 바인딩 개체를 가져오는 코드를 작성하자<br />
다음 SubscriberViewModel 인스턴스에 대한 참조 변수를 정의한다. 그러나 뷰 모델을 얻기 전에 팩토리 클래스를 사용하는 인스턴스, 팩토리 인스턴스를 생성해야 한다. SubscriberViewModelFactory 인스턴스를 생성하려면 dao 인스턴스를 인수로 전달해야 한다<br />
dao 인스턴스를 생성하여 시작하자</p>

<p>이제 데이터베이스에서 구독자의 데이터 목록을 관찰하는 함수를 만들자</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MainActivity.kt</span>
<span class="kd">class</span> <span class="nc">MainActivity</span> <span class="p">:</span> <span class="nc">AppCompatActivity</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">private</span> <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">binding</span><span class="p">:</span> <span class="nc">ActivityMainBinding</span>
    <span class="k">private</span> <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">subscriberViewModel</span><span class="p">:</span> <span class="nc">SubscriberViewModel</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
        <span class="n">binding</span> <span class="p">=</span> <span class="nc">DataBindingUtil</span><span class="p">.</span><span class="nf">setContentView</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nc">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">activity_main</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">dao</span> <span class="p">=</span> <span class="nc">SubscriberDatabase</span><span class="p">.</span><span class="nf">getInstance</span><span class="p">(</span><span class="n">application</span><span class="p">).</span><span class="n">subscriberDao</span>
        <span class="kd">val</span> <span class="py">repository</span> <span class="p">=</span> <span class="nc">SubscriberRepository</span><span class="p">(</span><span class="n">dao</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">factory</span> <span class="p">=</span> <span class="nc">SubscriberViewModelFactory</span><span class="p">(</span><span class="n">repository</span><span class="p">)</span>
        <span class="n">subscriberViewModel</span> <span class="p">=</span> <span class="nc">ViewModelProvider</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">factory</span><span class="p">).</span><span class="k">get</span><span class="p">(</span><span class="nc">SubscriberViewModel</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">myViewModel</span> <span class="p">=</span> <span class="n">subscriberViewModel</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">lifecycleOwner</span> <span class="p">=</span> <span class="k">this</span>
        <span class="nf">displaySubscribersList</span><span class="p">()</span>

    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">displaySubscribersList</span><span class="p">(){</span>
        <span class="n">subscriberViewModel</span><span class="p">.</span><span class="nf">getSaveSubscribers</span><span class="p">().</span><span class="nf">observe</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nc">Observer</span> <span class="p">{</span>
            <span class="nc">Log</span><span class="p">.</span><span class="nf">i</span><span class="p">(</span><span class="s">"MYTAG"</span><span class="p">,</span> <span class="n">it</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span>
        <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>list_item xml 레이아웃을 만들자</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// list_item.xml</span>
<span class="p">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="p">=</span><span class="s">"1.0"</span> <span class="n">encoding</span><span class="p">=</span><span class="s">"utf-8"</span><span class="p">?&gt;</span>
<span class="p">&lt;</span><span class="nc">LinearLayout</span> <span class="n">xmlns</span><span class="p">:</span><span class="n">android</span><span class="p">=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="n">xmlns</span><span class="p">:</span><span class="n">app</span><span class="p">=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span>
    <span class="n">android</span><span class="p">:</span><span class="n">layout_width</span><span class="p">=</span><span class="s">"match_parent"</span>
    <span class="n">android</span><span class="p">:</span><span class="n">layout_height</span><span class="p">=</span><span class="s">"wrap_content"</span>
    <span class="n">android</span><span class="p">:</span><span class="n">layout_marginBottom</span><span class="p">=</span><span class="s">"20dp"</span>
    <span class="n">android</span><span class="p">:</span><span class="n">orientation</span><span class="p">=</span><span class="s">"vertical"</span><span class="p">&gt;</span>


    <span class="p">&lt;</span><span class="n">androidx</span><span class="p">.</span><span class="n">cardview</span><span class="p">.</span><span class="n">widget</span><span class="p">.</span><span class="nc">CardView</span>
        <span class="n">android</span><span class="p">:</span><span class="n">id</span><span class="p">=</span><span class="s">"@+id/card_view"</span>
        <span class="n">android</span><span class="p">:</span><span class="n">layout_width</span><span class="p">=</span><span class="s">"match_parent"</span>
        <span class="n">android</span><span class="p">:</span><span class="n">layout_height</span><span class="p">=</span><span class="s">"wrap_content"</span>
        <span class="n">android</span><span class="p">:</span><span class="n">layout_gravity</span><span class="p">=</span><span class="s">"center"</span>
        <span class="n">android</span><span class="p">:</span><span class="n">clickable</span><span class="p">=</span><span class="s">"true"</span>
        <span class="n">android</span><span class="p">:</span><span class="n">focusable</span><span class="p">=</span><span class="s">"true"</span>
        <span class="n">app</span><span class="p">:</span><span class="n">cardBackgroundColor</span><span class="p">=</span><span class="s">"@color/teal_700"</span>
        <span class="n">app</span><span class="p">:</span><span class="n">cardCornerRadius</span><span class="p">=</span><span class="s">"10dp"</span>
        <span class="n">app</span><span class="p">:</span><span class="n">cardElevation</span><span class="p">=</span><span class="s">"10dp"</span> <span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nc">LinearLayout</span>
            <span class="n">android</span><span class="p">:</span><span class="n">id</span><span class="p">=</span><span class="s">"@+id/list_item_layout"</span>
            <span class="n">android</span><span class="p">:</span><span class="n">layout_width</span><span class="p">=</span><span class="s">"match_parent"</span>
            <span class="n">android</span><span class="p">:</span><span class="n">layout_height</span><span class="p">=</span><span class="s">"match_parent"</span>
            <span class="n">android</span><span class="p">:</span><span class="n">orientation</span><span class="p">=</span><span class="s">"vertical"</span><span class="p">&gt;</span>

            <span class="p">&lt;</span><span class="nc">TextView</span>
                <span class="n">android</span><span class="p">:</span><span class="n">id</span><span class="p">=</span><span class="s">"@+id/name_text_view"</span>
                <span class="n">android</span><span class="p">:</span><span class="n">layout_width</span><span class="p">=</span><span class="s">"wrap_content"</span>
                <span class="n">android</span><span class="p">:</span><span class="n">layout_height</span><span class="p">=</span><span class="s">"wrap_content"</span>
                <span class="n">android</span><span class="p">:</span><span class="n">layout_margin</span><span class="p">=</span><span class="s">"10dp"</span>
                <span class="n">android</span><span class="p">:</span><span class="n">text</span><span class="p">=</span><span class="s">"TextView"</span>
                <span class="n">android</span><span class="p">:</span><span class="n">textColor</span><span class="p">=</span><span class="s">"@color/white"</span>
                <span class="n">android</span><span class="p">:</span><span class="n">textSize</span><span class="p">=</span><span class="s">"30sp"</span>
                <span class="n">android</span><span class="p">:</span><span class="n">textStyle</span><span class="p">=</span><span class="s">"bold"</span> <span class="p">/&gt;</span>

            <span class="p">&lt;</span><span class="nc">TextView</span>
                <span class="n">android</span><span class="p">:</span><span class="n">id</span><span class="p">=</span><span class="s">"@+id/email_text_view"</span>
                <span class="n">android</span><span class="p">:</span><span class="n">layout_width</span><span class="p">=</span><span class="s">"wrap_content"</span>
                <span class="n">android</span><span class="p">:</span><span class="n">layout_height</span><span class="p">=</span><span class="s">"wrap_content"</span>
                <span class="n">android</span><span class="p">:</span><span class="n">layout_margin</span><span class="p">=</span><span class="s">"10dp"</span>
                <span class="n">android</span><span class="p">:</span><span class="n">text</span><span class="p">=</span><span class="s">"TextView"</span>
                <span class="n">android</span><span class="p">:</span><span class="n">textColor</span><span class="p">=</span><span class="s">"@color/white"</span>
                <span class="n">android</span><span class="p">:</span><span class="n">textSize</span><span class="p">=</span><span class="s">"24sp"</span>
                <span class="n">android</span><span class="p">:</span><span class="n">textStyle</span><span class="p">=</span><span class="s">"bold"</span> <span class="p">/&gt;</span>
        <span class="p">&lt;/</span><span class="nc">LinearLayout</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="n">androidx</span><span class="p">.</span><span class="n">cardview</span><span class="p">.</span><span class="n">widget</span><span class="p">.</span><span class="nc">CardView</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nc">LinearLayout</span><span class="p">&gt;</span>
</code></pre></div></div>

<p>이제 RecyclerView 어댑터에 대한 클래스를 생성한다</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MyRecylcerViewAdapter.kt</span>
<span class="kd">class</span> <span class="nc">MyRecyclerViewAdapter</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">subscribersList</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Subscriber</span><span class="p">&gt;):</span> <span class="nc">RecyclerView</span><span class="p">.</span><span class="nc">Adapter</span><span class="p">&lt;</span><span class="nc">MyViewHolder</span><span class="p">&gt;()</span> <span class="p">{</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreateViewHolder</span><span class="p">(</span><span class="n">parent</span><span class="p">:</span> <span class="nc">ViewGroup</span><span class="p">,</span> <span class="n">viewType</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">MyViewHolder</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">layoutInflater</span> <span class="p">=</span> <span class="nc">LayoutInflater</span><span class="p">.</span><span class="nf">from</span><span class="p">(</span><span class="n">parent</span><span class="p">.</span><span class="n">context</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">binding</span><span class="p">:</span> <span class="nc">ListItemBinding</span> <span class="p">=</span>
            <span class="nc">DataBindingUtil</span><span class="p">.</span><span class="nf">inflate</span><span class="p">(</span><span class="n">layoutInflater</span><span class="p">,</span> <span class="nc">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">list_item</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
        <span class="k">return</span> <span class="nc">MyViewHolder</span><span class="p">(</span><span class="n">binding</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onBindViewHolder</span><span class="p">(</span><span class="n">holder</span><span class="p">:</span> <span class="nc">MyViewHolder</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nc">Int</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">holder</span><span class="p">.</span><span class="nf">bind</span><span class="p">(</span><span class="n">subscribersList</span><span class="p">[</span><span class="n">position</span><span class="p">])</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">getItemCount</span><span class="p">():</span> <span class="nc">Int</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">subscribersList</span><span class="p">.</span><span class="n">size</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">MyViewHolder</span><span class="p">(</span><span class="kd">val</span> <span class="py">binding</span><span class="p">:</span> <span class="nc">ListItemBinding</span><span class="p">):</span> <span class="nc">RecyclerView</span><span class="p">.</span><span class="nc">ViewHolder</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="n">root</span><span class="p">){</span>
    <span class="k">fun</span> <span class="nf">bind</span><span class="p">(</span><span class="n">subscriber</span><span class="p">:</span> <span class="nc">Subscriber</span><span class="p">){</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">nameTextView</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="n">subscriber</span><span class="p">.</span><span class="n">name</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">emailTextView</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="n">subscriber</span><span class="p">.</span><span class="n">email</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>그리고 MainActivity에서 연결한다</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MainActivity.kt</span>
<span class="kd">class</span> <span class="nc">MainActivity</span> <span class="p">:</span> <span class="nc">AppCompatActivity</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">private</span> <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">binding</span><span class="p">:</span> <span class="nc">ActivityMainBinding</span>
    <span class="k">private</span> <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">subscriberViewModel</span><span class="p">:</span> <span class="nc">SubscriberViewModel</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
        <span class="n">binding</span> <span class="p">=</span> <span class="nc">DataBindingUtil</span><span class="p">.</span><span class="nf">setContentView</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nc">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">activity_main</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">dao</span> <span class="p">=</span> <span class="nc">SubscriberDatabase</span><span class="p">.</span><span class="nf">getInstance</span><span class="p">(</span><span class="n">application</span><span class="p">).</span><span class="n">subscriberDao</span>
        <span class="kd">val</span> <span class="py">repository</span> <span class="p">=</span> <span class="nc">SubscriberRepository</span><span class="p">(</span><span class="n">dao</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">factory</span> <span class="p">=</span> <span class="nc">SubscriberViewModelFactory</span><span class="p">(</span><span class="n">repository</span><span class="p">)</span>
        <span class="n">subscriberViewModel</span> <span class="p">=</span> <span class="nc">ViewModelProvider</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">factory</span><span class="p">).</span><span class="k">get</span><span class="p">(</span><span class="nc">SubscriberViewModel</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">myViewModel</span> <span class="p">=</span> <span class="n">subscriberViewModel</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">lifecycleOwner</span> <span class="p">=</span> <span class="k">this</span>
        <span class="nf">initRecyclerView</span><span class="p">()</span>

    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">initRecyclerView</span><span class="p">(){</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">subscriberRecyclerView</span><span class="p">.</span><span class="n">layoutManager</span> <span class="p">=</span> <span class="nc">LinearLayoutManager</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
        <span class="nf">displaySubscribersList</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">displaySubscribersList</span><span class="p">(){</span>
        <span class="n">subscriberViewModel</span><span class="p">.</span><span class="nf">getSaveSubscribers</span><span class="p">().</span><span class="nf">observe</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nc">Observer</span> <span class="p">{</span>
            <span class="nc">Log</span><span class="p">.</span><span class="nf">i</span><span class="p">(</span><span class="s">"MYTAG"</span><span class="p">,</span> <span class="n">it</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span>
            <span class="n">binding</span><span class="p">.</span><span class="n">subscriberRecyclerView</span><span class="p">.</span><span class="n">adapter</span> <span class="p">=</span> <span class="nc">MyRecyclerViewAdapter</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
        <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>RecyclerView에 클릭 리스너를 추가하자</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MainActivity.kt</span>
<span class="kd">class</span> <span class="nc">MainActivity</span> <span class="p">:</span> <span class="nc">AppCompatActivity</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">private</span> <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">binding</span><span class="p">:</span> <span class="nc">ActivityMainBinding</span>
    <span class="k">private</span> <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">subscriberViewModel</span><span class="p">:</span> <span class="nc">SubscriberViewModel</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>
        <span class="n">binding</span> <span class="p">=</span> <span class="nc">DataBindingUtil</span><span class="p">.</span><span class="nf">setContentView</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nc">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">activity_main</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">dao</span> <span class="p">=</span> <span class="nc">SubscriberDatabase</span><span class="p">.</span><span class="nf">getInstance</span><span class="p">(</span><span class="n">application</span><span class="p">).</span><span class="n">subscriberDao</span>
        <span class="kd">val</span> <span class="py">repository</span> <span class="p">=</span> <span class="nc">SubscriberRepository</span><span class="p">(</span><span class="n">dao</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">factory</span> <span class="p">=</span> <span class="nc">SubscriberViewModelFactory</span><span class="p">(</span><span class="n">repository</span><span class="p">)</span>
        <span class="n">subscriberViewModel</span> <span class="p">=</span> <span class="nc">ViewModelProvider</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">factory</span><span class="p">).</span><span class="k">get</span><span class="p">(</span><span class="nc">SubscriberViewModel</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">myViewModel</span> <span class="p">=</span> <span class="n">subscriberViewModel</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">lifecycleOwner</span> <span class="p">=</span> <span class="k">this</span>
        <span class="nf">initRecyclerView</span><span class="p">()</span>

    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">initRecyclerView</span><span class="p">(){</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">subscriberRecyclerView</span><span class="p">.</span><span class="n">layoutManager</span> <span class="p">=</span> <span class="nc">LinearLayoutManager</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
        <span class="nf">displaySubscribersList</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">displaySubscribersList</span><span class="p">(){</span>
        <span class="n">subscriberViewModel</span><span class="p">.</span><span class="nf">getSaveSubscribers</span><span class="p">().</span><span class="nf">observe</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nc">Observer</span> <span class="p">{</span>
            <span class="nc">Log</span><span class="p">.</span><span class="nf">i</span><span class="p">(</span><span class="s">"MYTAG"</span><span class="p">,</span> <span class="n">it</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span>
            <span class="n">binding</span><span class="p">.</span><span class="n">subscriberRecyclerView</span><span class="p">.</span><span class="n">adapter</span> <span class="p">=</span> <span class="nc">MyRecyclerViewAdapter</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span> <span class="n">selectedItem</span><span class="p">:</span> <span class="nc">Subscriber</span> <span class="p">-&gt;</span>
                <span class="nf">listItemClicked</span><span class="p">(</span>
                    <span class="n">selectedItem</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">})</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">listItemClicked</span><span class="p">(</span><span class="n">subscriber</span><span class="p">:</span> <span class="nc">Subscriber</span><span class="p">){</span>
        <span class="nc">Toast</span><span class="p">.</span><span class="nf">makeText</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="s">"selected name is ${subscriber.name}"</span> <span class="p">,</span><span class="nc">Toast</span><span class="p">.</span><span class="nc">LENGTH_SHORT</span><span class="p">).</span><span class="nf">show</span><span class="p">()</span>
        <span class="n">subscriberViewModel</span><span class="p">.</span><span class="nf">initUpdateAndDelete</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>

<p>업데이트 및 삭제 기능을 구현하기 위해 이 클릭 리스너를 추가했다</p>

<p>텍스트 입력 필드에 선택한 이름과 이메일을 표시하는 코드를 작성하자<br />
그리고 모두 지우기 및 삭제 기능을 구현하자. 저장 또는 업데이트도 구현하자</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SubscriberViewModel.kt</span>
<span class="kd">class</span> <span class="nc">SubscriberViewModel</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">repository</span><span class="p">:</span> <span class="nc">SubscriberRepository</span><span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">private</span> <span class="kd">var</span> <span class="py">isUpdateOrDelete</span> <span class="p">=</span> <span class="k">false</span>
    <span class="k">private</span> <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">subscriberToUpdateOrDelete</span><span class="p">:</span> <span class="nc">Subscriber</span>

    <span class="kd">val</span> <span class="py">inputName</span> <span class="p">=</span> <span class="nc">MutableLiveData</span><span class="p">&lt;</span><span class="nc">String</span><span class="err">?</span><span class="p">&gt;()</span>
    <span class="kd">val</span> <span class="py">inputEmail</span> <span class="p">=</span> <span class="nc">MutableLiveData</span><span class="p">&lt;</span><span class="nc">String</span><span class="err">?</span><span class="p">&gt;()</span>

    <span class="kd">val</span> <span class="py">saveOrUpdateButtonText</span> <span class="p">=</span> <span class="nc">MutableLiveData</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;()</span>
    <span class="kd">val</span> <span class="py">clearAllOrDeleteButtonText</span> <span class="p">=</span> <span class="nc">MutableLiveData</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;()</span>

    <span class="nf">init</span> <span class="p">{</span>
        <span class="n">saveOrUpdateButtonText</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="s">"Save"</span>
        <span class="n">clearAllOrDeleteButtonText</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="s">"Clear All"</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">saveOrUpdate</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">isUpdateOrDelete</span><span class="p">){</span>
            <span class="n">subscriberToUpdateOrDelete</span><span class="p">.</span><span class="n">name</span> <span class="p">=</span> <span class="n">inputName</span><span class="p">.</span><span class="n">value</span><span class="o">!!</span>
            <span class="n">subscriberToUpdateOrDelete</span><span class="p">.</span><span class="n">email</span> <span class="p">=</span> <span class="n">inputEmail</span><span class="p">.</span><span class="n">value</span><span class="o">!!</span>
            <span class="nf">update</span><span class="p">(</span><span class="n">subscriberToUpdateOrDelete</span><span class="p">)</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="kd">val</span> <span class="py">name</span> <span class="p">=</span> <span class="n">inputName</span><span class="p">.</span><span class="n">value</span><span class="o">!!</span>
            <span class="kd">val</span> <span class="py">email</span> <span class="p">=</span> <span class="n">inputEmail</span><span class="p">.</span><span class="n">value</span><span class="o">!!</span>
            <span class="nf">insert</span><span class="p">(</span><span class="nc">Subscriber</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="p">))</span>
            <span class="n">inputName</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="k">null</span>
            <span class="n">inputEmail</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="k">null</span>
        <span class="p">}</span>

    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">clearAllOrDelete</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">isUpdateOrDelete</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">delete</span><span class="p">(</span><span class="n">subscriberToUpdateOrDelete</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">clearAll</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">insert</span><span class="p">(</span><span class="n">subscriber</span><span class="p">:</span> <span class="nc">Subscriber</span><span class="p">)</span> <span class="p">=</span>
        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="n">repository</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">update</span><span class="p">(</span><span class="n">subscriber</span><span class="p">:</span> <span class="nc">Subscriber</span><span class="p">)</span> <span class="p">=</span>
        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="n">repository</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span>
            <span class="n">inputName</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="k">null</span>
            <span class="n">inputEmail</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="k">null</span>
            <span class="n">isUpdateOrDelete</span> <span class="p">=</span> <span class="k">false</span>
            <span class="n">saveOrUpdateButtonText</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="s">"Save"</span>
            <span class="n">clearAllOrDeleteButtonText</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="s">"Clear All"</span>
        <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">delete</span><span class="p">(</span><span class="n">subscriber</span><span class="p">:</span> <span class="nc">Subscriber</span><span class="p">)</span> <span class="p">=</span>
        <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
            <span class="n">repository</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="n">subscriber</span><span class="p">)</span>
            <span class="n">inputName</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="k">null</span>
            <span class="n">inputEmail</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="k">null</span>
            <span class="n">isUpdateOrDelete</span> <span class="p">=</span> <span class="k">false</span>
            <span class="n">saveOrUpdateButtonText</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="s">"Save"</span>
            <span class="n">clearAllOrDeleteButtonText</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="s">"Clear All"</span>
        <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">clearAll</span><span class="p">()</span> <span class="p">=</span> <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
        <span class="n">repository</span><span class="p">.</span><span class="nf">deleteAll</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">getSaveSubscribers</span><span class="p">()</span> <span class="p">=</span> <span class="nf">liveData</span> <span class="p">{</span>
        <span class="n">repository</span><span class="p">.</span><span class="n">subscribers</span><span class="p">.</span><span class="nf">collect</span> <span class="p">{</span>
            <span class="nf">emit</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">initUpdateAndDelete</span><span class="p">(</span><span class="n">subscriber</span><span class="p">:</span> <span class="nc">Subscriber</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">inputName</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="n">subscriber</span><span class="p">.</span><span class="n">name</span>
        <span class="n">inputEmail</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="n">subscriber</span><span class="p">.</span><span class="n">email</span>
        <span class="n">isUpdateOrDelete</span> <span class="p">=</span> <span class="k">true</span>
        <span class="n">subscriberToUpdateOrDelete</span> <span class="p">=</span> <span class="n">subscriber</span>
        <span class="n">saveOrUpdateButtonText</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="s">"Update"</span>
        <span class="n">clearAllOrDeleteButtonText</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="s">"Delete"</span>
    <span class="p">}</span>


<span class="p">}</span>
</code></pre></div></div>

<p>다른 상황에서는 뷰 모델에서 뷰와 통신해야 할 수도 있다. 사용자에게 결과를 알리기 위해 토스트 메시지나 스낵바를 표시해야 할 수도 있다. 이를 수행하는 한 가지 방법은 일부 기능으로 별도의 인터페이스를 만드는 것이다. 그런 다음 Activity가 해당 인터페이스를 구현하고 뷰 모델에서 해당 기능을 호출하도록 한다. 그러나 그것은 올바른 접근 방식이 아니다. MVVM 아키텍처의 기본 사항을 위반하기 때문이다. MVVM에서 뷰 모델은 뷰에 대해 알지 않아야 한다. 뷰 모델에는 뷰에 대한 참조가 없어야 한다.</p>

<p>Evnet 클래스를 생성하여 이벤트에 대한 라이브 데이터를 사용할 수 있다. SingleLiveEvent 클래스. SingleLiveEvent의 문제는 관찰자가 한 명으로 제한된다는 것이다. Event 래퍼를 사용하는 것이 권장되는 모범 사례이다. Event 래퍼 클래스는 이벤트의 상태를 명시적으로 고려합니다.
MVVM 아키텍처를 위반하지 않고 View에 메시지를 표시하는 방법이다</p>

<p>아래 코드는 상용구 코드이다</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Event.kt</span>
<span class="k">open</span> <span class="kd">class</span> <span class="nc">Event</span><span class="p">&lt;</span><span class="k">out</span> <span class="nc">T</span><span class="p">&gt;(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">content</span><span class="p">:</span> <span class="nc">T</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="py">hasBeenHandled</span> <span class="p">=</span> <span class="k">false</span>
        <span class="k">private</span> <span class="k">set</span>


    <span class="k">fun</span> <span class="nf">getContentIfNotHandled</span><span class="p">():</span> <span class="nc">T</span><span class="p">?{</span>
        <span class="k">return</span> <span class="k">if</span><span class="p">(</span><span class="n">hasBeenHandled</span><span class="p">){</span>
            <span class="k">null</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="n">hasBeenHandled</span> <span class="p">=</span> <span class="k">true</span>
            <span class="n">content</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">fun</span> <span class="nf">peekContent</span><span class="p">():</span> <span class="nc">T</span> <span class="p">=</span> <span class="n">content</span>
<span class="p">}</span>
</code></pre></div></div>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            <!--
            
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to LEE</h3>
                    <p>Get the latest posts delivered right to your inbox</p>
                    <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()"
               id="searchtext" type="text" name="searchtext"
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
                </section>
            
            -->


            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/built/images/author-logo.jpg" alt="lee989898" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/lee989898">lee989898</a></h4>
                                
                                    <p><a href="https://github.com/lee989898">깃허브</a></p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/lee989898">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            var this_page_url = 'https://lee989898.github.io/ad';
                            var this_page_identifier = '/ad';
                            var this_page_title = 'Room';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://xxxxxxxx.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/built/images/blog-cover1.png)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; LEE &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/android/">Android</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/ad">LifeCycleScope</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/ad">ViewModel + Livedata + 코루틴</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/ad">Coroutines</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/android/">
                                
                                    See all 15 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/bc-03">
                <div class="post-card-image" style="background-image: url(/assets/built/images/blockchain-logo.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/bc-03">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Blockchain</span>
                            
                        
                    

                    <h2 class="post-card-title">Bitcoin Keys and Addresses</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>
  비트코인 소유권은 다음을 기반으로 한다


</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/built/images/author-logo.jpg" alt="lee989898" />
                        
                        <span class="post-card-author">
                            <a href="/author/lee989898/">lee989898</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://lee989898.github.io/">
            
            <span>LEE</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Room</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Room&amp;url=https://lee989898.github.io/ad"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://lee989898.github.io/ad"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://lee989898.github.io/">LEE</a> &copy; 2022</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyllt/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
    <div id="subscribe" class="subscribe-overlay">
        <a class="subscribe-overlay-close" href="#"></a>
        <div class="subscribe-overlay-content">
            
            <h1 class="subscribe-overlay-title">Search LEE</h1>
            <p class="subscribe-overlay-description">
                lunr.js를 이용한 posts 검색 </p>
            <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()"
               id="searchtext" type="text" name="searchtext"
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
        </div>
    </div>
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-xxxxxxxx-x', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
