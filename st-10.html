<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>POSIX Thread Programming</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->

    <!-- custom.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/custom.css" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- 웹 폰트 -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothic.css">

    <!-- syntax.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="공부 블로그" />
    <link rel="shortcut icon" href="https://lee989898.github.io/assets/built/images/favicon.jpg" type="image/png" />
    <link rel="canonical" href="https://lee989898.github.io/st-10" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

    


     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="LEE" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="POSIX Thread Programming" />
    <meta property="og:description" content="POSIX Thread Programming Thread Overview ​ 프로세스처럼 독립적으로 수행되는 프로그램 코드​ “경량 프로세스(light-weight process)”라고도 함​ “프로세스 내에서 독립적으로, 순차적으로 수행되는 instruction stream 또는 제어의 흐름”이라고도 함​ 여러 스레드는 동시에 실행이 가능​ 스레드들의 실행에 관한 스케쥴링은 OS가 담당​ 싱글 코어에서도 여러 스레드의 실행이 가능 ​ 한 프로세스내의 스레드들은 같은 주소 공간을" />
    <meta property="og:url" content="https://lee989898.github.io/st-10" />
    <meta property="og:image" content="https://lee989898.github.io/assets/built/images/system-logo.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2021-11-24T01:06:00+09:00" />
    <meta property="article:modified_time" content="2021-11-24T01:06:00+09:00" />
    <meta property="article:tag" content="System" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="POSIX Thread Programming" />
    <meta name="twitter:description" content="POSIX Thread Programming Thread Overview ​ 프로세스처럼 독립적으로 수행되는 프로그램 코드​ “경량 프로세스(light-weight process)”라고도 함​ “프로세스 내에서 독립적으로, 순차적으로 수행되는 instruction stream 또는 제어의 흐름”이라고도 함​ 여러 스레드는 동시에 실행이 가능​ 스레드들의 실행에 관한 스케쥴링은 OS가 담당​ 싱글 코어에서도 여러 스레드의 실행이 가능 ​ 한 프로세스내의 스레드들은 같은 주소 공간을" />
    <meta name="twitter:url" content="https://lee989898.github.io/" />
    <meta name="twitter:image" content="https://lee989898.github.io/assets/built/images/system-logo.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="LEE" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="System" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "LEE",
        "logo": "https://lee989898.github.io/"
    },
    "url": "https://lee989898.github.io/st-10",
    "image": {
        "@type": "ImageObject",
        "url": "https://lee989898.github.io/assets/built/images/system-logo.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://lee989898.github.io/st-10"
    },
    "description": "POSIX Thread Programming Thread Overview ​ 프로세스처럼 독립적으로 수행되는 프로그램 코드​ “경량 프로세스(light-weight process)”라고도 함​ “프로세스 내에서 독립적으로, 순차적으로 수행되는 instruction stream 또는 제어의 흐름”이라고도 함​ 여러 스레드는 동시에 실행이 가능​ 스레드들의 실행에 관한 스케쥴링은 OS가 담당​ 싱글 코어에서도 여러 스레드의 실행이 가능 ​ 한 프로세스내의 스레드들은 같은 주소 공간을"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="POSIX Thread Programming" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://lee989898.github.io/">LEE</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-kotlin" role="menuitem"><a href="/tag/kotlin/">코틀린</a></li>
    <li class="nav-algorithm" role="menuitem"><a href="/tag/algorithm/">알고리즘</a></li>
    <li class="nav-pl" role="menuitem"><a href="/tag/pl/">프로그래밍언어</a></li>
    <li class="nav-android" role="menuitem"><a href="/tag/android/">안드로이드</a></li>
    <li class="nav-security" role="menuitem"><a href="/tag/security/">컴퓨터보안</a></li>
    <li class="nav-system" role="menuitem"><a href="/tag/system/">시스템프로그래밍</a></li>
    <li class="nav-systemcloud" role="menuitem"><a href="/tag/systemcloud/">시스템클라우드보안</a></li>
    <li class="nav-blockchain" role="menuitem"><a href="/tag/blockchain/">블록체인</a></li>
    <li class="nav-archive" role="menuitem">
        
        <a href="/archive.html">All Posts</a>
    </li>
    <li class="nav-archive" role="menuitem">
        <a href="/author_archive.html">Tag별 Posts</a>
    </li>


</ul>



        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Search</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-system post tag-system ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="24 November 2021">24 November 2021</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/system/'>SYSTEM</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">POSIX Thread Programming</h1>
            </header>

            <!--
            
            <figure class="post-full-image" style="background-image: url(/assets/built/images/system-logo.png)">
            </figure>
            
            -->
            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <h3 id="posix-thread-programming"><strong>POSIX Thread Programming</strong></h3>

<hr />

<h2 id="thread-overview-">Thread Overview ​</h2>

<ul>
  <li>프로세스처럼 독립적으로 수행되는 프로그램 코드​
    <ul>
      <li>“경량 프로세스(light-weight process)”라고도 함​</li>
      <li>“프로세스 내에서 독립적으로, 순차적으로 수행되는 instruction stream 또는 제어의 흐름”이라고도 함​</li>
      <li>여러 스레드는 동시에 실행이 가능​</li>
      <li>스레드들의 실행에 관한 스케쥴링은 OS가 담당​</li>
      <li>싱글 코어에서도 여러 스레드의 실행이 가능 ​</li>
    </ul>
  </li>
  <li>한 프로세스내의 스레드들은 같은 주소 공간을 사용 ​
    <ul>
      <li>공유 매모리를 이용하여 스레드간의 통신을 이용함으로써 복잡한 프로세스간 통신(IPC) 기능을 사용하지 않아도 됨​</li>
      <li>스레드간의 통신 비용이 IPC 비용보다 낮음​</li>
    </ul>
  </li>
</ul>

<p><img src="\assets\built\images\st\st25.png" alt="시스템프로그래밍" /></p>

<ul>
  <li>Process는 실행을 위하여 resource들이 필요하며 실행 상태를 메모리에 저장 ​
    <ul>
      <li>Process ID, group ID, … ​</li>
      <li>Program instructions​</li>
      <li>Registers, Stack​</li>
      <li>Heap ​</li>
      <li>File descriptor, …​</li>
    </ul>
  </li>
  <li>Thread는 Process 내부에 존재하면서 resource들을 같이 사용 ​
    <ul>
      <li>Registers, stack, 등은 thread 별로 따로 존재  ​</li>
    </ul>
  </li>
</ul>

<p><img src="\assets\built\images\st\st26.png" alt="시스템프로그래밍" /></p>

<ul>
  <li>공통 스레드 구현​
    <ul>
      <li>병렬 소스 코드 내에서 호출되는 서브루틴 라이브러리</li>
      <li>직렬 또는 병렬 소스 코드에 포함된 컴파일러 지시문 세트</li>
    </ul>
  </li>
  <li>스레드 구현은 컴퓨팅에서 새로운 것이 아니다
    <ul>
      <li>역사적으로 하드웨어 공급업체는 고유한 스레드 버전을 구현했다</li>
      <li>이러한 구현은 서로 상당히 다르다</li>
      <li>프로그래머가 휴대용 스레드 응용 프로그램을 개발하기 어려움​</li>
    </ul>
  </li>
  <li>관련 없는 표준화 노력으로 인해 두 개의 매우 다른 스레드 구현이 발생했다
    <ul>
      <li>POSIX Threads (Pthread)​</li>
      <li>OpenMP​</li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="pthread-introduction-">Pthread Introduction ​</h2>

<ul>
  <li>IEEE POSIX (Portable Operating System Interface for UNIX) 1003.1c Standard​
    <ul>
      <li>과거에 하드웨어 업체별로 각각 제작되어 사용되었던 스레드에 관한 구현을 표준화 ​</li>
      <li>이 표준에 따라 구현된 스레드를 POSIX Thread 또는 Pthread로 부름​
        <ul>
          <li>스레드를 생성하고 동기화하는 system call 들로 구성​</li>
        </ul>
      </li>
      <li>표준화는 계속 진행 중​
        <ul>
          <li>가장 최근의  표준은 IEEE Std 1003.1, 2004 Edition​</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>C-프로그래밍 언어의 type과 procedure call의 집합으로 정의 ​
    <ul>
      <li>
        <pthread.h> header 파일 및 thread library로 구현​
</pthread.h>
        <ul>
          <li>libc library의 일부로 구현되기도 함​</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>우수한 성능 : 프로세스와 비교​
    <ul>
      <li>스레드 생성에 드는 OS overhead가 프로세스 생성에 비해 현격히 낮음​
        <ul>
          <li>50,000번의 프로세스 생성(fork() 사용) vs. 스레드 생성(pthread_create() 사용) ​</li>
          <li>실행 시간의 단위는 second, time 커맨드에 의해 측정​</li>
          <li>스레드 관리에 드는 resource도 프로세스에 비해 현격히 적음​</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Pthread에서는 ​
    <ul>
      <li>Parallelism 생성​</li>
      <li>동기화(synchronization)​을 지원함​</li>
    </ul>
  </li>
  <li>Communication에 대한 explicit한 지원은 없음​
    <ul>
      <li>Shared-memory 모델이므로 communication은 implicit하게 일어남​
​</li>
    </ul>
  </li>
  <li>스레드의 상태​
    <ul>
      <li>준비(ready) : 스레드가 실행될 수 있는 상태​</li>
      <li>실행(running) : CPU의 서비스를 받고 있는 상태​</li>
      <li>블록(block) : sleep(), read(), 세마포어 연산 등으로 기다리는 상태​</li>
      <li>종료(terminated) : 스레드가 종료 또는 취소된 상태​
​</li>
    </ul>
  </li>
  <li>준비 상태​
    <ul>
      <li>스레드가 처음 생성되면 준비 상태로 감​</li>
      <li>CPU의 서비스를 받을 수 있는 상태​</li>
    </ul>
  </li>
  <li>실행 상태​
    <ul>
      <li>OS의 스케줄러에 의해 CPU의 서비스를 받고 있는 상태​</li>
      <li>스케줄링에 의해 준비상태로 갈 수 있음​</li>
    </ul>
  </li>
  <li>블록 상태​
    <ul>
      <li>실행 상태에서 즉시 처리할 수 없는 작업을 만나는 경우​
        <ul>
          <li>read(), wait(), sleep(), 세마포어/뮤텍스/조건변수를 기다리는 경우​</li>
        </ul>
      </li>
      <li>원하는 조건이 만족되면 준비 상태가 됨​</li>
    </ul>
  </li>
  <li>종료 상태​
    <ul>
      <li>스레드 시작함수에서 return 또는 pthread_exit()가 호출된 경우​</li>
      <li>사용하던 자원의 대부분을 시스템에 반납​</li>
      <li>종료 상태 값을 부모 스레드에게 넘겨주기 위한 자원은 부모 스레드에서 pthread_join()을 통해 읽어가면 완전히 삭제​</li>
    </ul>
  </li>
  <li>Application 프로그램은 하나의 스레드로 시작​
    <ul>
      <li>Main 스레드 또는 master 스레드로 불림 ​</li>
    </ul>
  </li>
  <li>pthread_create() 호출에 의해 새로운 child 스레드를 생성​
    <ul>
      <li>새로운 child 스레드의 생성은 procedure 호출의 형태를 띔​</li>
    </ul>
  </li>
  <li>pthread_exit() 또는 pthread_join() 호출에 의해 새로 생성되었던 스레드 종료​
    <ul>
      <li>Master 스레드만 남게 됨​</li>
    </ul>
  </li>
</ul>

<p><img src="\assets\built\images\st\st27.png" alt="시스템프로그래밍" /></p>

<blockquote>
  <p>스레드 생성</p>
</blockquote>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">pthread_create</span> <span class="p">(</span><span class="err">​</span>
  <span class="n">pthread_t</span>   <span class="o">*</span><span class="kr">thread</span><span class="p">,</span> <span class="c1">// 생성된 스레드의 핸들 ​</span>
  <span class="n">pthread_attr_t</span>   <span class="o">*</span><span class="n">attr</span><span class="p">,</span> <span class="c1">// 스레드 속성을 지정하는 인자​</span>
  <span class="kt">void</span>   <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">start_routine</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">),</span> <span class="c1">// 스레드 시작함수(start routine) 주소​</span>
  <span class="kt">void</span>   <span class="o">*</span><span class="n">arg</span> <span class="p">)</span> <span class="c1">// 스레드 시작 함수의 인자(들)</span>
</code></pre></div></div>

<ul>
  <li>thread : 새로운 child 스레드가 성공적으로 생성될 경우 생성된 스레드의 핸들​</li>
  <li>attr : 생성되는 child 스레드의 속성을 지정(디폴트 값은 NULL)​</li>
  <li>start_routine : 새로 생성되는 child 스레드를 지정하는 함수의 시작 주소​</li>
  <li>arg : 시작 함수들의 인자(들)​</li>
  <li>리턴 값 ​
    <ul>
      <li>성공시 0을 리턴​</li>
      <li>에러 발생시 에러코드의 정수 값(errno)을 리턴​</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>Pthread 프로그램 컴파일</p>
</blockquote>

<ul>
  <li>일반적으로 –lpthread 옵션이 필요​
    <ul>
      <li>스레드 라이브러리가 다른 라이브러리(예 : libc)에 통합된 경우는 불필요 ​</li>
    </ul>
  </li>
  <li>-D_REENTRANT 옵션​
    <ul>
      <li>멀티 스레드 환경에서 싱글 스레드의 경우와 구별된 errno를 사용하도록 함​</li>
      <li>일반 함수들이 멀티 스레드 환경에 적합하게 동작하도록 함​</li>
    </ul>
  </li>
  <li>컴파일 예제​
    <ul>
      <li>Linux/GCC의 경우​
        <ul>
          <li>% gcc test.c –lpthread (-lpthread 옵션에 –D_REENTRANT 포함)​</li>
        </ul>
      </li>
      <li>Solaris/Studio 컴파일러의 경우​
        <ul>
          <li>% cc –mt test.c (-mt 옵션에 –D_REENTRANT 포함, 스레드 라이브러리는 libc 라이브러리에 포함됨) ​</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>스레드 종료</p>
</blockquote>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span>  <span class="nf">pthread_exit</span><span class="p">(</span><span class="kt">void</span>   <span class="o">*</span><span class="n">retval</span><span class="p">);</span><span class="err">​</span>
</code></pre></div></div>

<ul>
  <li>생성된 child 스레드의 종료​
    <ul>
      <li>프로세스와 마찬가지로 return을 만나면 종료​</li>
      <li>또는 pthread_exit() 호출시 종료​</li>
      <li>pthread_exit() 호출에 의해 child 스레드가 종료할 경우 할당되었던 자원들은 반납되지 않음​</li>
      <li>나중에 pthread_join() 호출에 의해 반납됨 ​</li>
      <li>Detach 된 스레드는 예외  ​</li>
    </ul>
  </li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span>  <span class="nf">pthread_join</span><span class="p">(</span><span class="n">pthread_t</span>   <span class="n">thrd</span><span class="p">,</span>   <span class="kt">void</span>   <span class="o">**</span><span class="n">thread_return</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>Parent 스레드에서 호출​
    <ul>
      <li>자신이 생성한 child 스레드가 종료할 때까지 기다림​
        <ul>
          <li>thrd​
            <ul>
              <li>종료를 기다릴 스레드의 핸들​</li>
            </ul>
          </li>
          <li>thread_return​
            <ul>
              <li>child 스레드의 종료 상태가 저장됨​</li>
              <li>NULL로 하면 종료 상태를 받지 않음​</li>
              <li>child 스레드의 종료값은 return, pthread_exit()로 남길 수 있음​</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Child 스레드가 종료되기 전에 parent 스레드가 먼저 종료되지 않게 할 때 사용​
    <ul>
      <li>Parent 스레드가 종료하면 child 스레드가 함께 종료되며​</li>
      <li>Child 스레드의 작업이 모두 이루어 지지 않은 상태일 수 있음​</li>
    </ul>
  </li>
  <li>Child 스레드의 종료 시점을 정확히 파악하여 어떤 작업을 하고 싶거나 종료 상태 값을 얻기 위해 사용​</li>
  <li>종료된 child 스레드에 할당되었던 resource 들은 반납됨 ​</li>
</ul>

<blockquote>
  <p>스레드 Detach</p>
</blockquote>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span>   <span class="nf">pthread_detach</span><span class="p">(</span><span class="n">pthread_t</span>   <span class="n">thrd</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>Detached 스레드​
    <ul>
      <li>Join이 가능한 스레드(pthread_join()을 사용)와 대비​</li>
      <li>Parent 스레드가 생성한 child 스레드에 대해 pthread_detach()를 호출하면 parent 스레드가 나중에 wait하지 않음​
        <ul>
          <li>빠른 스레드의 실행에 도움이 됨​</li>
        </ul>
      </li>
      <li>Detach 된 스레드에 pthread_join()를 호출하면 error 발생​</li>
      <li>Detach 된 스레드는 pthread_join() 호출 없이 할당되었던 resources 들이 반납됨</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>스레드 Attribute</p>
</blockquote>

<ul>
  <li>스레드의 attribute는 스레드가 생성될 때 설정됨
    <ul>
      <li>이미 생성된 스레드의 attribute 값을 바꾸는 것은 제한적인 경우에만 가능 ​</li>
    </ul>
  </li>
  <li>따라서 pthread_create를 호출하기 전에 원하는 attribute 값들을 설정해야 ​</li>
  <li>Attribute 설정과 관련된 pthread API
    <ul>
      <li>pthread_attr_init()​</li>
      <li>pthread_attr_destroy()​</li>
      <li>pthread_attr_setdetachstate()​</li>
      <li>pthread_attr_getstacksize()​</li>
      <li>pthread_attr_setstacksize()​</li>
    </ul>
  </li>
  <li>스레드는 joinable 또는 detached 스레드로 생성 가능​</li>
  <li>Default stack size는 OS 마다 다른 값을 지정​</li>
  <li>최소 스택 크기는 변수 PTHREAD_STACK_MIN에 저장된다</li>
</ul>

<blockquote>
  <p>기타 스레드 Attribute들</p>
</blockquote>

<ul>
  <li>Guard size: 스택 오버플로로부터 보호하기 위해 사용</li>
  <li>스케줄링 속성 상속(스레드 생성에서) or not</li>
  <li>Scheduling parameter(s): 특히 스레드 우선순위</li>
  <li>Scheduling policy: FIFO or Round Robin​</li>
  <li>Contention scope: 이 스레드는 어떤 스레드와 CPU를 놓고 경쟁하는가</li>
  <li>Stack address: 스택의 위치를 ​​명시적으로 지정</li>
  <li>Lazy stack allocation: 요청 시 할당(lazy) 또는 한 번에 모두 선행</li>
</ul>

<hr />

<h2 id="synchronization">Synchronization​</h2>

<blockquote>
  <p>스레드의 동기화 문제</p>
</blockquote>

<ul>
  <li>여러 스레드가 공유 데이터에 접근하여 값들을 읽거나 저장
    <ul>
      <li>Run time 에 공유 데이터가 어떤 값을 가질지 예측하기 어려움​</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>Data race 문제</p>
</blockquote>

<ul>
  <li>두 개 이상의 스레드가 같은 변수를 access, 그 중 적어도 하나의 access는 write 연산을 실행​</li>
  <li>Access들이 동시에 발생, 그러나 동기화되지 않은 상태로</li>
</ul>

<blockquote>
  <p>기본적인 동기화 Mechanism: Mutex</p>
</blockquote>

<ul>
  <li>스레드들이 서로 배타적으로 공유데이터에 접근하도록 하기위해 Mutex (mutual exclusion)를 사용​
    <ul>
      <li>스레드들은 거의 독립적으로 실행​</li>
      <li>Common한 data structure를 사용함​</li>
    </ul>
  </li>
  <li>Mutex외에도 세마포어를 많이 사용​</li>
</ul>

<blockquote>
  <p>Mutex 사용방법</p>
</blockquote>

<ul>
  <li>Critical 영역에 들어가기 전에 mutex 를 잠금​</li>
  <li>Critical 영역에서 나오면서 mutex 잠금을 해제​</li>
  <li>다른 스레드들은 이 mutex 잠금이 해제될 때까지 대기​</li>
  <li>Mutex 사용 절차</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pthread_mutex_t</span> <span class="n">mutex</span><span class="p">;</span> <span class="c1">// 뮤텍스 선언​</span>
<span class="n">Pthread_mutex_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span> <span class="c1">// 뮤텍스 초기화 작업​</span>
<span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span> <span class="c1">// 뮤텍스 잠금​</span>
<span class="p">...</span> <span class="c1">// 공유데이터(크리티컬 영역) 액세스​</span>
<span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span> <span class="c1">// 뮤텍스 잠금 해제​</span>
</code></pre></div></div>

<blockquote>
  <p>Mutex 선언 및 초기화</p>
</blockquote>

<ul>
  <li>Mutex의 변수 타입 : pthread_mutex_t​</li>
  <li>여러 스레드들이 사용하므로 전역 변수로 선언​</li>
  <li>반드시 초기화를 해야 사용 가능​</li>
  <li>초기화 방법​
    <ul>
      <li>함수를 통한 초기화​</li>
      <li>매크로를 통한 초기화​</li>
    </ul>
  </li>
  <li>Mutex 초기화에 특별한 타입을 지정하지 않음 ​</li>
  <li>단 한 번의 잠금만 허용​
    <ul>
      <li>스레드 A가 잠금을 하고 있는 상황에서 스레드 B가 잠금을 시도하면 B는 A의 잠금이 해제될 때까지 기다림​</li>
      <li>A에 의해 잠긴 뮤텍스에 대해 A가 다시 잠금을 시도하면 deadlock이 발생하여 A는 영원히 블록 상태가 됨​</li>
      <li>이러한 현상을 피하기 위해 pthread_mutex_trylock()을 사용​</li>
      <li>Mutex를 얻지 못하는 경우 블록되지 않고 바로 리턴되고 EBUSY 에러 발생​</li>
    </ul>
  </li>
  <li>잠금되어 있는 않은 mutex에 잠금해제를 시도하면 아무 동작을 하지 않음​</li>
</ul>

<blockquote>
  <p>Mutex의 삭제</p>
</blockquote>

<ul>
  <li>더 이상 mutex를 사용하지 않을 때 삭제​</li>
  <li>잠금 상태의 mutex를 삭제하려 시도하면 에러 발생​
    <ul>
      <li>EBUSY 에러 발생​</li>
    </ul>
  </li>
  <li>Mutex의 현재 상태(잠금, 잠금해제) 확인 함수는 없음​</li>
  <li>안전하게 mutex를 삭제하기 위해서는 삭제 전에 무조건 mutex를 해제해야 함​</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span><span class="err">​</span>
<span class="n">pthread_mutex_destory</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span>
</code></pre></div></div>

<blockquote>
  <p>Mutex와 deadlock</p>
</blockquote>

<ul>
  <li>Deadlock​
    <ul>
      <li>두 개의 스레드가 두 개의 mutex를 사용​</li>
      <li>각 스레드가 mutex를 하나씩 잠그고 있는 상태에서 상대방의 mutex 해제를 기다리는 현상​</li>
      <li>deadlock이 발생하면 프로그램은 영원히 블록​</li>
    </ul>
  </li>
  <li>Deadlock을 피하는 방법​
    <ul>
      <li>Mutex를 잠그는데 일정한 순서를 정하여 사용​</li>
    </ul>
  </li>
  <li>성능​
    <ul>
      <li>Mutex를 많이 사용하면 프로그램의 성능이 저하됨​</li>
      <li>Mutex를 얻은 상태에서 처리하는 작업의 양(Critical Section)을 최소화 해야 함​
        <ul>
          <li>Mutex가 잠긴 동안 다른 스레드가 블록될 가능성이 높으며 Critical Section이 길수록 전체 프로그램 성능이 저하될 수 있음​</li>
        </ul>
      </li>
      <li>다른 data structure에 대해서는 다른 lock을 적용</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>Spin Lock​</p>
</blockquote>

<ul>
  <li>Mutex lock 과 달리, lock을 얻을때까지 CPU cycle을 소비하면서 계속 spinning 함​
    <ul>
      <li>Mutex lock : lock을 얻지 못하면 바로 sleep 모드로 들어감 ​</li>
      <li>Adaptive mutex lock : 잠깐 동안 spinning 하다가 sleep 모드로 들어감 ​</li>
    </ul>
  </li>
  <li>Spin lock APIs​
    <ul>
      <li>pthread_spin_init() ​
        <ul>
          <li>PTHREAD_PROCESS_PRIVATE : 생성되는 spin lock이 프로세스에 private 하게 사용될 경우 ​</li>
          <li>PTHREAD_PROCESS_SHARED : 다른 프로세스와 공유할 경우​</li>
        </ul>
      </li>
      <li>pthread_spin_lock()​</li>
      <li>pthread_spin_unlock()​</li>
      <li>pthread_spin_destroy()​</li>
    </ul>
  </li>
  <li>pthread_spin_trylock() ​
    <ul>
      <li>Lock을 얻으려 시도​</li>
      <li>Lock을 얻는 경우나 얻지 못하는 경우 모두 바로 리턴</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>Barrier</p>
</blockquote>

<ul>
  <li>Barrier: 글로벌 동기화
    <ul>
      <li>특히 SPMD(동일한 기능의 여러 복사본을 병렬로 실행할 때)</li>
    </ul>
  </li>
  <li>Simple use of barriers: all threads hit the same one​
    <ul>
      <li>work_on_my_subgrid();​</li>
      <li>barrier;​</li>
      <li>read_neighboring_values();​</li>
      <li>barrier;​</li>
    </ul>
  </li>
  <li>more complicated: barriers on branches (or loops)​
    <ul>
      <li>if (thread_id % 2 == 0) {​</li>
      <li>work1();​</li>
      <li>barrier; } ​</li>
      <li>else ​</li>
      <li>barrier;​</li>
    </ul>
  </li>
  <li>
    <p>모든 스레드 라이브러리에 Barrier가 제공되지 않는다</p>
  </li>
  <li>Barrier APIs​
    <ul>
      <li>pthread_barrier_init(&amp;barrier, attr, no_of_threads)
        <ul>
          <li>pthread_barrier_t  barrier;</li>
          <li>Default value of attr is “NULL”</li>
        </ul>
      </li>
      <li>pthread_barrier_destroy(&amp;barrier)</li>
      <li>pthread_barrier_wait(&amp;barrier)</li>
    </ul>
  </li>
</ul>

<hr />

<h2 id="semaphore"><strong>Semaphore</strong></h2>

<hr />

<ul>
  <li>Semaphore : counting and signaling mechanism
    <ul>
      <li>지정된 개수의 아이템들을 위한 접근 제어에 활용
        <ul>
          <li>아이템 개수가 하나이면 mutex와 동일​</li>
        </ul>
      </li>
      <li>스레드간에 신호를 보내는 역할​</li>
    </ul>
  </li>
  <li>두 종류의 semaphore​
    <ul>
      <li>Named semaphore​</li>
      <li>Unnamed semaphore</li>
    </ul>
  </li>
  <li>Unnamed semaphore의 초기화​</li>
</ul>

<p>sem_t <em>sem;​<br />
int sem_init(sem_t</em>sem, int pshared, unsigned int value);</p>

<ul>
  <li>sem : 세마포어 객체​</li>
  <li>pshared : 다른 스레드와 공유할 것인지의 여부​</li>
  <li>value : 세마포어의 초기값​</li>
  <li>예 : sem_init(&amp;sem, 0, 10)​</li>
</ul>

<p>Unnamed semaphore의 종료​</p>

<ul>
  <li>
    <p>sem_destroy(&amp;sem)</p>
  </li>
  <li>Named semaphore의 초기화​
    <ul>
      <li>sem_open(sem_name, FLAGS, permission, value)​</li>
      <li>예 : sem_open(“/my_sem”, O_CREAT, 0777, 10)​</li>
    </ul>
  </li>
  <li>Named semaphore의 종료​
    <ul>
      <li>sem_close(sem) : semaphore와의 연결을 끊지만, 시스템 상에 semaphore를 남겨둠​</li>
      <li>sem_unlink(sem_name) : semaphore에 사용된 resource를 free 시킴</li>
    </ul>
  </li>
  <li>세마포어의 값을 감소시키는 함수 ​
    <ul>
      <li>크리티컬 영역에 진입하면서 자동으로 세마포어의 값을 감소(-1)시킴</li>
    </ul>
  </li>
</ul>

<p>int sem_wait(sem_t <em>sem);​<br />
int sem_trywait(sem_t</em>sem);</p>

<ul>
  <li>
    <p>세마포어의 값을 1 증가시키는 함수<br />
int sem_post(sem_t *sem);</p>
  </li>
  <li>
    <p>현재 세마포어의 값을 읽는 함수<br />
int sem_getvalue(sem_t <em>sem, int</em> sval);</p>
  </li>
</ul>

<hr />

<h2 id="conditional-variable"><strong>Conditional Variable</strong></h2>

<hr />

<ul>
  <li>조건변수​
    <ul>
      <li>스레드 간에 특정 조건이 발생했음을 알리는 통신을 위해 사용​</li>
      <li>조건변수는 반드시 mutex와 함께 사용되어야 한다​</li>
    </ul>
  </li>
  <li>조건변수의 생성​
    <ul>
      <li>함수를 이용한 초기화와 매크로를 이용한 초기화 방법이 있음​<br />
pthread_cond_t cond;​</li>
    </ul>
  </li>
</ul>

<p>pthread_cond_init(&amp;cond, NULL); // 함수를 이용한 초기화​</p>

<p>pthread_cond_t cond = PTHREAD_COND_INITIALIZER; // 매크로를 이용​</p>

<ul>
  <li>조건변수의 삭제​</li>
</ul>

<p>pthread_cond_destory(&amp;cond);</p>

<ul>
  <li>조건변수를 기다리는 함수​</li>
</ul>

<p>int pthread_cond_wait(pthread_cond_t <em>cond, pthread_mutex_t</em>mutex);​</p>

<ul>
  <li>cond : 조건 알림이 발생할 때까지 대기​</li>
  <li>mutex : mutex가 cond를 제어​</li>
  <li>동작​
    <ul>
      <li>Mutex 해제 -&gt; 블록 상태 -&gt; 조건 알림을 받음 -&gt; 깨어나면서 mutex를 얻음​</li>
    </ul>
  </li>
  <li>조건 알림을 보내는 함수​
int pthread_cond_signal(pthread_cond_t *cond);</li>
  <li>
    <p>조건 변수 cond에 의해 기다리던 조건이 발생했음을 대기하고 있는 스레드에게 통보​</p>
  </li>
  <li>하나의 생산자 스레드와 여러개의 소비자 스레드가 있는 경우​
    <ul>
      <li>pthread_cond_signal() 함수를 사용하면 단 하나의 스레드만 깨우고 나머지 스레드는 영원히 기다릴 가능성이 있음​</li>
      <li>pthread_cond_broadcast()를 사용​
        <ul>
          <li>여러 스레드를 동시에 깨움​</li>
          <li>깨어난 스레드들 중 공유 데이터를 위한 mutex를 얻은 스레드만이 공유 데이터에 접근​</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Producer-Consumer 예제 ​
    <ul>
      <li>Queue를 사용​
        <ul>
          <li>생산자 스레드는 queue에 메시지 쓰기 작업을 수행​</li>
          <li>소비자 스레드는 queue에서 메시지 읽기 작업을 수행​</li>
          <li>운영체제의 scheduler는 생산자와 소비자 스레드가 교대로 실행되는 것을 보장하지 않음​</li>
        </ul>
      </li>
      <li>조건변수를 사용하여 queue의 길이가 0보다 클 경우 소비자 스레드를 깨움​</li>
    </ul>
  </li>
</ul>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            <!--
            
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to LEE</h3>
                    <p>Get the latest posts delivered right to your inbox</p>
                    <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()"
               id="searchtext" type="text" name="searchtext"
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
                </section>
            
            -->


            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/built/images/author-logo.jpg" alt="lee989898" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/lee989898">lee989898</a></h4>
                                
                                    <p><a href="https://github.com/lee989898">깃허브</a></p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/lee989898">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            var this_page_url = 'https://lee989898.github.io/st-10';
                            var this_page_identifier = '/st-10';
                            var this_page_title = 'POSIX Thread Programming';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://xxxxxxxx.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/built/images/blog-cover1.png)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; LEE &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/system/">System</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/st-09">프로세스통신-socket</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/st-08">프로세스통신-pipe</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/st-07">Signal</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/system/">
                                
                                    See all 9 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/pl-20">
                <div class="post-card-image" style="background-image: url(/assets/built/images/pl-background-frontend.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/pl-20">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Pl</span>
                            
                        
                    

                    <h2 class="post-card-title">FPLs</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>FPLs

</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/built/images/author-logo.jpg" alt="lee989898" />
                        
                        <span class="post-card-author">
                            <a href="/author/lee989898/">lee989898</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      2 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/sc-17">
                <div class="post-card-image" style="background-image: url(/assets/built/images/security-logo.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/sc-17">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Security</span>
                            
                        
                    

                    <h2 class="post-card-title">__방화벽__</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>방화벽

</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/built/images/author-logo.jpg" alt="lee989898" />
                        
                        <span class="post-card-author">
                            <a href="/author/lee989898/">lee989898</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://lee989898.github.io/">
            
            <span>LEE</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">POSIX Thread Programming</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=POSIX+Thread+Programming&amp;url=https://lee989898.github.io/st-10"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://lee989898.github.io/st-10"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://lee989898.github.io/">LEE</a> &copy; 2022</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyllt/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
    <div id="subscribe" class="subscribe-overlay">
        <a class="subscribe-overlay-close" href="#"></a>
        <div class="subscribe-overlay-content">
            
            <h1 class="subscribe-overlay-title">Search LEE</h1>
            <p class="subscribe-overlay-description">
                lunr.js를 이용한 posts 검색 </p>
            <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()"
               id="searchtext" type="text" name="searchtext"
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
        </div>
    </div>
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-xxxxxxxx-x', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
