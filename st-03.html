<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>File IO</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->

    <!-- custom.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/custom.css" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- 웹 폰트 -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/nanumgothic.css">

    <!-- syntax.css -->
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="공부 블로그" />
    <link rel="shortcut icon" href="https://lee989898.github.io/assets/built/images/favicon.jpg" type="image/png" />
    <link rel="canonical" href="https://lee989898.github.io/st-03" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

    


     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="LEE" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="File IO" />
    <meta property="og:description" content="File IO open() : 열기 open()은 버퍼 공간을 확보하여 파일을 읽거나 쓸 때 사용한다 파일이 존재하지 않을 경우 open()에 의해 새로운 파일이 만들어지기도 한다 #include &lt;sys/types.h&gt; #include &lt;sys/stat.h&gt; #include &lt;fcntl.h&gt; int open(const char *pathname, int flags); int open(const char *pathname, int flags, mode_t mode); pathname: 경로(path)명을 포함한 파일의 이름 또는" />
    <meta property="og:url" content="https://lee989898.github.io/st-03" />
    <meta property="og:image" content="https://lee989898.github.io/assets/built/images/system-logo.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2021-09-15T01:06:00+09:00" />
    <meta property="article:modified_time" content="2021-09-15T01:06:00+09:00" />
    <meta property="article:tag" content="System" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="File IO" />
    <meta name="twitter:description" content="File IO open() : 열기 open()은 버퍼 공간을 확보하여 파일을 읽거나 쓸 때 사용한다 파일이 존재하지 않을 경우 open()에 의해 새로운 파일이 만들어지기도 한다 #include &lt;sys/types.h&gt; #include &lt;sys/stat.h&gt; #include &lt;fcntl.h&gt; int open(const char *pathname, int flags); int open(const char *pathname, int flags, mode_t mode); pathname: 경로(path)명을 포함한 파일의 이름 또는" />
    <meta name="twitter:url" content="https://lee989898.github.io/" />
    <meta name="twitter:image" content="https://lee989898.github.io/assets/built/images/system-logo.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="LEE" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="System" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "LEE",
        "logo": "https://lee989898.github.io/"
    },
    "url": "https://lee989898.github.io/st-03",
    "image": {
        "@type": "ImageObject",
        "url": "https://lee989898.github.io/assets/built/images/system-logo.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://lee989898.github.io/st-03"
    },
    "description": "File IO open() : 열기 open()은 버퍼 공간을 확보하여 파일을 읽거나 쓸 때 사용한다 파일이 존재하지 않을 경우 open()에 의해 새로운 파일이 만들어지기도 한다 #include &lt;sys/types.h&gt; #include &lt;sys/stat.h&gt; #include &lt;fcntl.h&gt; int open(const char *pathname, int flags); int open(const char *pathname, int flags, mode_t mode); pathname: 경로(path)명을 포함한 파일의 이름 또는"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="File IO" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://lee989898.github.io/">LEE</a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-kotlin" role="menuitem"><a href="/tag/kotlin/">코틀린</a></li>
    <li class="nav-algorithm" role="menuitem"><a href="/tag/algorithm/">알고리즘</a></li>
    <li class="nav-pl" role="menuitem"><a href="/tag/pl/">프로그래밍언어</a></li>
    <li class="nav-android" role="menuitem"><a href="/tag/android/">안드로이드</a></li>
    <li class="nav-security" role="menuitem"><a href="/tag/security/">컴퓨터보안</a></li>
    <li class="nav-system" role="menuitem"><a href="/tag/system/">시스템프로그래밍</a></li>
    <li class="nav-systemcloud" role="menuitem"><a href="/tag/systemcloud/">시스템클라우드보안</a></li>
    <li class="nav-blockchain" role="menuitem"><a href="/tag/blockchain/">블록체인</a></li>
    <li class="nav-archive" role="menuitem">
        
        <a href="/archive.html">All Posts</a>
    </li>
    <li class="nav-archive" role="menuitem">
        <a href="/author_archive.html">Tag별 Posts</a>
    </li>


</ul>



        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Search</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-system post tag-system ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="15 September 2021">15 September 2021</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/system/'>SYSTEM</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">File IO</h1>
            </header>

            <!--
            
            <figure class="post-full-image" style="background-image: url(/assets/built/images/system-logo.png)">
            </figure>
            
            -->
            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <h3 id="file-io"><strong>File IO</strong></h3>

<hr />

<blockquote>
  <p>open() : 열기</p>
</blockquote>

<ul>
  <li>open()은 버퍼 공간을 확보하여 파일을 읽거나 쓸 때 사용한다</li>
  <li>파일이 존재하지 않을 경우 open()에 의해 새로운 파일이 만들어지기도 한다</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;fcntl.h&gt;
</span>
<span class="kt">int</span> <span class="nf">open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pathname</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pathname</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">,</span> <span class="n">mode_t</span> <span class="n">mode</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>pathname: 경로(path)명을 포함한 파일의 이름 또는 장치 이름</li>
</ul>

<hr />

<ul>
  <li>flag: 파일 상태 플래그
    <ul>
      <li>파일을 열 때 취해지는 구체적 행동을 기술한다</li>
      <li>파일 액세스 flag와 선택적인 flag의 OR 연산으로 나타낸다</li>
    </ul>
  </li>
  <li>파일 액세스 flag: 다음 중 하나만 사용할 수 있다</li>
</ul>

<table>
  <thead>
    <tr>
      <th>모드(값,8진수)</th>
      <th>설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>O_RDONLY(00)</td>
      <td>읽기 전용으로 열기</td>
    </tr>
    <tr>
      <td>O_WRONLY(01)</td>
      <td>쓰기 전용으로 열기</td>
    </tr>
    <tr>
      <td>O_RDWR(02)</td>
      <td>읽기/쓰기용으로 열기</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>선택적인 flag:</li>
</ul>

<table>
  <thead>
    <tr>
      <th>모드(값,8진수)</th>
      <th>설명</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>O_APPEND(02000)</td>
      <td>파일의 끝에서부터 데이터를 추가하여 쓴다</td>
    </tr>
    <tr>
      <td>O_TRUNC(01000)</td>
      <td>파일의 크기를 0으로 만든다(내용삭제)</td>
    </tr>
    <tr>
      <td>O_CREAT(0100)</td>
      <td>파일이 존재하지 않을 경우 생성한다</td>
    </tr>
  </tbody>
</table>

<hr />

<ul>
  <li>mode:
    <ul>
      <li>mode_t 타입(unsigned int)</li>
      <li>새로운 파일을 만들 대만 필요</li>
      <li>Flag에 O_CREAT를 지정한 경우에만 필요 <img src="\assets\built\images\st\st05.png" alt="시스템프로그래밍" /></li>
      <li>0~8비트 : 파일의 보호 모드</li>
      <li>sticky 비트(공유모드)
        <ul>
          <li>여러 사용자들이 이용하는 실행파일에 설정</li>
          <li>실행 후 텍스트 이미지를 메모리에 보관함으로써 다음 번에 실행될 떄 빠르게 실행하도록 하기 위해 지정</li>
        </ul>
      </li>
      <li>setuid 비트 : 1로 셋트 되면 일반사용자가 해당 파일의 소유자 권한으로 파일을 실행할 수 있도록 해준다</li>
      <li>setgid 비트 : 1로 셋트 되면 일반그룹이 해당 그룹의 소유자  권한으로 파일을 실행 할 수 있도록 해준다​</li>
      <li>setuid , setgid 비트를 설정하면, 그 파일을 실행하고 있는 동안만 그 프로세스의 실효 사용자 ID와 실효 그룹 ID를 그 실행파일의 소유자 ID와  그룹 ID로 변경할 수 있다 ​</li>
      <li>예 : root 사용자만이 실행할 수 있는 프로그램을 setuid/setgid 비트를 설정하여 일반 사용자가 실행할 수 있도록 해 준다</li>
      <li>O_CREAT flag를 사용하여 파일 생성시, 다음의 매개인자를 사용한다</li>
    </ul>
  </li>
</ul>

<table>
  <thead>
    <tr>
      <th>매크로</th>
      <th>의미</th>
      <th> </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>S_IRUSR</td>
      <td>소유자에게 읽기 권한</td>
      <td> </td>
    </tr>
    <tr>
      <td>S_IWUSR</td>
      <td>소유자에게 쓰기 권한</td>
      <td> </td>
    </tr>
    <tr>
      <td>S_IXUSR</td>
      <td>소유자에게 실행 권한</td>
      <td> </td>
    </tr>
    <tr>
      <td>S_IRGRP</td>
      <td>소유그룹에게 읽기권한​</td>
      <td> </td>
    </tr>
    <tr>
      <td>S_IWGRP</td>
      <td>소유그룹에게 쓰기권한​</td>
      <td> </td>
    </tr>
    <tr>
      <td>S_IXGRP</td>
      <td>소유그룹에게 실행권한</td>
      <td> </td>
    </tr>
    <tr>
      <td>S_IROTH​</td>
      <td>other에게 읽기권한​</td>
      <td> </td>
    </tr>
    <tr>
      <td>S_IWOTH​</td>
      <td>other에게 쓰기권한​</td>
      <td> </td>
    </tr>
    <tr>
      <td>S_IXOTH</td>
      <td>other에게 실행권한</td>
      <td> </td>
    </tr>
    <tr>
      <td>S_IRWXU​</td>
      <td>소유자에게 읽기, 쓰기, 실행권한</td>
      <td>​</td>
    </tr>
    <tr>
      <td>S_IRWXG​</td>
      <td>소유그룹에게 읽기, 쓰기, 실행권한</td>
      <td>​</td>
    </tr>
    <tr>
      <td>S_IRWXO​</td>
      <td>other에게 읽기, 쓰기, 실행권한​</td>
      <td> </td>
    </tr>
    <tr>
      <td>S_ISUID​</td>
      <td>셋 사용자 ID 비트를 설정​</td>
      <td> </td>
    </tr>
    <tr>
      <td>S_ISGID​</td>
      <td>셋 그룹 ID 비트를 설정</td>
      <td>​</td>
    </tr>
    <tr>
      <td>S_ISVTX​</td>
      <td>STICKY 비트를 설정</td>
      <td>​</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>
    <p>세번째 인자인 mode는 sys/stat.h에서 정의된 플래그의 OR연산으로 만들어진다</p>
  </li>
  <li>
    <p>리턴 값: 파일 디스크립터 값 또는 -1(open()이 실패할 경우)</p>
  </li>
</ul>

<p>ex) int fd;<br />
fd = open(“afile”, O_RDWR);<br />
ex) int fd;<br />
fd = open(“afile”, O_RDWR|O_CREAT,S_IRUSR|S_IWUSR);</p>

<hr />

<ul>
  <li>File descriptor table: ​
    <ul>
      <li>열려진 모든 파일들은 각각 _IO_FILE 이라는 구조체(/usr/include/libio.h 에 정의 됨)에 정보가 저장됨 ​</li>
      <li>한 프로세스에 의해 열려진 모든 파일들의 _IO_FILE  타입의 구조체들은 연결 리스트로 결합되어지며, 이것을 file descriptor table이라고 부른다 ​</li>
    </ul>
  </li>
  <li>File descriptor table에서 특정 파일의 위치를 가리키는 index 값(int 타입)을 file descriptor 라고 부른다 ​</li>
  <li>File descriptor 값들 중 0, 1, 2는 특별한 파일들을 위하여 사용된다​
    <ul>
      <li>0은 stdin, 1은 stdout, 그리고 2는 stderr 파일을 지칭한다</li>
    </ul>
  </li>
</ul>

<hr />

<blockquote>
  <p>close(): 닫기</p>
</blockquote>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;unistd.h&gt;
</span>
<span class="kt">int</span> <span class="nf">close</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>close()는 작업을 종료하기 위해 사용된다​</li>
  <li>리턴 값 : 성공이면 0, 에러 발생시 -1을 반환​</li>
  <li>fd : 닫고자 하는 파일의 파일 디스크립터​</li>
  <li>한 프로세스에서 열 수 있는 최대 파일 수는 limits.h 내의 상수 OPEN_MAX에서 정의됨(/usr/include/bits/posix1_lim.h)​</li>
  <li>이 제한은 시스템에 따라 다르지만, POSIX에서는 적어도 20이 되도록 정해져 있다​</li>
  <li>한꺼번에 열려진 파일의 개수가 OPEN_MAX가 넘지 않도록 close()를 적절히 사용하여야 한다 ​</li>
  <li>파일을 닫지 않더라도 프로세스가 종료하면 모든 열려진 파일들은 자동적으로 닫힌다​</li>
</ul>

<hr />

<blockquote>
  <p>creat(): 파일 생성</p>
</blockquote>

<ul>
  <li>새로운 파일을 만들거나, 이미 존재하고 있는 파일의 내용을 모두 무시하고 다시 쓸 때 사용한다​</li>
  <li>pathname : 경로명​</li>
  <li>mode : open()의 mode와 동일​</li>
  <li>리턴 값 : 파일 디스크립터, 실패하면 -1</li>
  <li>다음의 두 함수 호출은 기능이 동일하다​
    <ul>
      <li>creat( pathname, mode ); ​</li>
      <li>
        <table>
          <tbody>
            <tr>
              <td>open ( pathname, O_WRONLY</td>
              <td>O_CREAT</td>
              <td>O_TRUNC, mode);​</td>
            </tr>
          </tbody>
        </table>
      </li>
    </ul>
  </li>
  <li>creat()에서는 그 파일의 크기를 0으로 만든다 ​</li>
  <li>이때 소유자 모드는 변경하지 않는다​</li>
  <li>creat()는 open()이 있기 때문에 많이 쓰이지 않는다</li>
</ul>

<hr />

<blockquote>
  <p>read(): 읽기</p>
</blockquote>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;unistd.h&gt;
</span>
<span class="kt">ssize_t</span> <span class="nf">read</span><span class="p">(</span><span class="kt">int</span> <span class="n">filedes</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nbytes</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>파일에서 원하는 크기의 데이터를 읽는다​</li>
  <li>리턴 값 :​
    <ul>
      <li>성공하면 읽은 byte 수​</li>
      <li>파일의 끝을 만나면 0  읽기 종료​</li>
      <li>실패하면 -1​</li>
    </ul>
  </li>
  <li>buf : 읽은 데이터를 저장할 메모리의 시작 주소​</li>
  <li>nbytes : 읽을 바이트 수​</li>
  <li>buf는 임의의 type의 포인터(generic 포인터)가 될 수 있도록 void 타입으로 지정한다​</li>
  <li>읽을 데이터가 충분하면 한 번에 nbytes 만큼 읽는다​</li>
  <li>읽을 데이터가 nbytes 보다 적은 경우 더 적게 읽기도 한다​</li>
</ul>

<p>ssize_t  read (int filedes,  void *buf, size_t nbytes);​</p>

<ul>
  <li>size_t  : unsigned integer (unistd.h에서 정의)​</li>
  <li>ssize_t : signed integer (unistd.h에서 정의)</li>
</ul>

<hr />

<blockquote>
  <p>write(): 쓰기</p>
</blockquote>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;unistd.h&gt;
</span>
<span class="kt">ssize_t</span> <span class="nf">write</span><span class="p">(</span><span class="kt">int</span> <span class="n">filedes</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nbytes</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>파일에 데이터를 쓴다​</li>
  <li>리턴 값​
    <ul>
      <li>성공하면 파일에 쓰여진 데이터의 바이트 수​</li>
      <li>실패하면 -1​</li>
    </ul>
  </li>
  <li>buf : 쓸 데이터를 저장하고 있는 메모리 공간​</li>
  <li>nbytes : 쓸 데이터의 바이트 수</li>
</ul>

<hr />

<blockquote>
  <p>lseek(): 파일의 현재 위치 이동</p>
</blockquote>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;
</span>
<span class="kt">off_t</span> <span class="nf">lseek</span> <span class="p">(</span><span class="kt">int</span> <span class="n">filedes</span><span class="p">,</span> <span class="kt">off_t</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">int</span> <span class="n">whence</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>lseek는 파일에 대한 임의접근을 가능하게 한다​</li>
  <li>파일의 현재 위치(current file offset)를 이동시킨다. 즉 읽기-쓰기 포인터의 위치, 다음에 읽거나 쓸 바이트의 위치를 변경할 수 있다​</li>
  <li>파일의 현재 위치(current file offset)​
    <ul>
      <li>파일에 대한 읽기/쓰기는 파일의 현재 위치에서 실행된다​</li>
      <li>파일을 처음 열면 현재 위치는 0, 즉 파일의 시작이다​</li>
      <li>읽기/쓰기 후 파일의 현재 위치는 읽기/쓰기 한 byte 수 만큼 저절로 뒤로 이동된다​</li>
      <li>lseek()를 사용하여  임의의 위치로 파일의 현재 위치를 이동할 수 있다​</li>
      <li>offset은 음수가 될 수도 있다​</li>
    </ul>
  </li>
  <li>리턴 값: 성공하면 현재의 읽기/쓰기 포인터의 위치를 리턴, 실패하면 -1</li>
  <li>offset : 기준점에 더해질 바이트의 수 (byte 단위)​
    <ul>
      <li>SEEK_CUR, SEEK_END 와 같이 쓰일 때는 음수도 가능​</li>
      <li>off_t는 long int와 같은 의미를 나타낸다​</li>
    </ul>
  </li>
  <li>whence : 시작위치 정하는 방법으로, 다음 중 하나를 사용한다</li>
</ul>

<table>
  <thead>
    <tr>
      <th>매크로 이름</th>
      <th>값</th>
      <th>포인터 위치 지정 방법</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>SEEK_SET</td>
      <td>0</td>
      <td>offset이 파일의 맨 앞에서부터 더해져 이동</td>
    </tr>
    <tr>
      <td>SEEK_CUR</td>
      <td>1</td>
      <td>현재위치에 offset이 더해져 이동</td>
    </tr>
    <tr>
      <td>SEEK_END</td>
      <td>2</td>
      <td>파일의 마지막 바이트 번호에 더해 이동</td>
    </tr>
  </tbody>
</table>

<hr />

<blockquote>
  <p>Disk</p>
</blockquote>

<p><img src="\assets\built\images\st\st06.png" alt="시스템프로그래밍" /></p>

<ul>
  <li>Disk들은 platters들로 구성되어 있으며, 각 platter는 두개의 표면(surface)을 갖는다.​
    <ul>
      <li>각 surface는 동심원 모양의 track들로 구성​</li>
      <li>각 track은 sectors들로 구성되는데, sector들은 gap으로 구분된다</li>
      <li>정렬된 track들은 cylinder를 이룬다</li>
    </ul>
  </li>
  <li>최근의 disk는 track들을 recording zone들로 분할한다 ​
    <ul>
      <li>같은 zone 내부의 track들은 같은 개수의 sector들을 갖는다</li>
      <li>Zone마다 track 당 sector의 개수(sectors/track )가 달라진다. 바깥 쪽 zone은 track당 sector의 개수가 더 많아진다.   ​</li>
      <li>따라서, disk의 용량을 계산할 때  track당 평균 sector의 개수를 사용한다. ​</li>
    </ul>
  </li>
</ul>

<hr />

<blockquote>
  <p>I/O efficiency</p>
</blockquote>

<ul>
  <li>디스크는 mechanical device로서 메모리 (DRAM) 에 비해서 상대적으로 성능이 매우 느린 장치​</li>
  <li>성능을 위해서는 디스크 I/O의 횟수를 줄이는 것이 바람직(seek time + rotational delay)​
    <ul>
      <li>작은 양을 여러번 I/O 하는 것 보다​</li>
      <li>많은 양을 한꺼번에 I/O 하여 횟수를 줄이는 것이 좋다​</li>
    </ul>
  </li>
</ul>

<hr />

<blockquote>
  <p>dup(), dup2(): 파일 디스크립터 복제</p>
</blockquote>

<ul>
  <li>사용 중인 파일 디스크립터의 복사본을 제공​</li>
  <li>Oldfd가 가리키는 사용자 파일 디스크립터 표의 구조체를 새로운 파일 디스크립터가 가리키도록 한다 ​</li>
  <li>리턴 값: 성공하면 복사된 새 파일 디스크립터, 실패하면 -1​
    <ul>
      <li>dup() 함수는 할당 가능한 가장 작은 번호를 리턴한다​</li>
      <li>dup2() 함수는 newfd를 리턴한다​</li>
    </ul>
  </li>
</ul>

<p>fdin = open(“in-file”, O_RDONLY);​<br />
close(0);​<br />
dup(fdin);​<br />
close(fdin);</p>

<p><img src="\assets\built\images\st\st07.png" alt="시스템프로그래밍" /></p>

<hr />

<blockquote>
  <p>stat(), fstat(), lstat(): 파일 조작</p>
</blockquote>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
</span>
<span class="kt">int</span> <span class="nf">stat</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">pathname</span><span class="p">,</span> <span class="k">struct</span> <span class="n">stat</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">fstat</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="k">struct</span> <span class="n">stat</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
<span class="kt">int</span> <span class="nf">lstat</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">pathname</span><span class="p">,</span> <span class="k">struct</span> <span class="n">stat</span> <span class="o">*</span> <span class="n">buf</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>파일 조작 시스템 호출은 파일 상태에 대한 정보를 stat 구조체에 가져온다​</li>
  <li>리턴값: 성공시 0,  실패시 -1​</li>
  <li>pathname: 파일의 경로명​</li>
  <li>buf: stat 구조체(파일정보)를 저장하는 구조체​</li>
  <li>stat()가 경로명으로 파일을 지정하는 반면, fstat()는 파일 디스크립터를 지정한다​</li>
  <li>
    <p>lstat()는 대상 파일이 심볼릭 링크(symbolic link)인 경우에 링크가 나타내는 파일이 아니라 링크 자신의 상태를 가져온다​</p>
  </li>
  <li>stat 구조체 내용</li>
</ul>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span>  <span class="n">stat</span> <span class="p">{</span><span class="err">​</span>
 <span class="n">mode_t</span>   <span class="n">st_mode</span><span class="p">;</span> <span class="err">파일</span> <span class="err">모드에</span> <span class="err">대한</span> <span class="err">정보​</span>
 <span class="n">ino_t</span>      <span class="n">st_ino</span><span class="p">;</span> <span class="err">파일의</span> <span class="n">I</span><span class="o">-</span><span class="n">node</span> <span class="err">번호​</span>
 <span class="n">dev_t</span>      <span class="n">st_dev</span><span class="p">;</span> <span class="n">I</span><span class="o">-</span><span class="n">node</span><span class="err">가</span> <span class="err">있는</span> <span class="err">디바이스의</span> <span class="err">디바이스번호​</span>
 <span class="n">dev_t</span> <span class="n">st_rdev</span><span class="p">;</span> <span class="err">디바이스번호</span><span class="p">(</span><span class="err">디바이스</span> <span class="err">파일의</span> <span class="err">경우</span><span class="p">)</span><span class="err">​</span>
 <span class="n">nlink_t</span> <span class="n">st_nlink</span><span class="p">;</span>  <span class="err">파일에</span> <span class="err">관련된</span> <span class="err">링크의</span> <span class="err">수​</span>
 <span class="n">uid_t</span> <span class="n">st_uid</span><span class="p">;</span>    <span class="err">소유자의</span> <span class="err">사용자</span> <span class="n">ID</span><span class="err">​</span>
 <span class="n">gid_t</span> <span class="n">st_gid</span><span class="p">;</span>    <span class="err">소유자의</span> <span class="err">그룹</span> <span class="n">ID</span><span class="err">​</span>
 <span class="kt">off_t</span> <span class="n">st_size</span><span class="p">;</span>   <span class="err">파일크기</span><span class="p">(</span><span class="err">바이트</span> <span class="err">수</span><span class="p">)</span><span class="err">​</span>
 <span class="kt">time_t</span> <span class="n">st_atime</span><span class="p">;</span>  <span class="err">최종</span> <span class="err">엑세스</span> <span class="err">시각​</span>
 <span class="kt">time_t</span> <span class="n">st_mtime</span><span class="p">;</span> <span class="err">최종</span> <span class="err">변경</span> <span class="err">시각​</span>
 <span class="kt">time_t</span> <span class="n">st_ctime</span><span class="p">;</span>  <span class="err">최종</span> <span class="err">상태</span> <span class="err">변경</span> <span class="err">시각​</span>
 <span class="n">blksize_t</span> <span class="n">st_blksize</span><span class="p">;</span> <span class="err">파일</span> <span class="err">시스템의</span> <span class="err">블록</span> <span class="err">크기​</span>
 <span class="n">blkcnt_t</span> <span class="n">st_blocks</span><span class="p">;</span> <span class="err">할당된</span> <span class="err">블록수​</span>
<span class="p">};</span>  
<span class="o">---</span>

<span class="o">&gt;</span> <span class="n">access</span><span class="p">()</span><span class="o">:</span> <span class="err">파일에</span> <span class="err">대한</span> <span class="err">액세스</span> <span class="err">권한</span> <span class="err">검사</span>

<span class="err">```</span><span class="n">c</span>
<span class="cp">#include &lt;unistd.h&gt;
</span>
<span class="kt">int</span> <span class="nf">access</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">pathname</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>파일에 대하여 mode로 전해준 액세스 권한이 있는지 없는지 확인한다​</li>
  <li>pathname : 경로명​</li>
  <li>mode : 모드​</li>
  <li>리턴값 : 성공시 0, 에러시 -1</li>
</ul>

<table>
  <thead>
    <tr>
      <th>매크로 이름</th>
      <th>비트패턴</th>
      <th>액세스 권한</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>R_OK</td>
      <td>100</td>
      <td>읽기</td>
    </tr>
    <tr>
      <td>W_OK</td>
      <td>010</td>
      <td>쓰기</td>
    </tr>
    <tr>
      <td>X_OK</td>
      <td>001</td>
      <td>실행</td>
    </tr>
    <tr>
      <td>F_OK</td>
      <td>000</td>
      <td>파일이 존재하는지 아닌지</td>
    </tr>
  </tbody>
</table>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            <!--
            
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscribe to LEE</h3>
                    <p>Get the latest posts delivered right to your inbox</p>
                    <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()"
               id="searchtext" type="text" name="searchtext"
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
                </section>
            
            -->


            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/built/images/author-logo.jpg" alt="lee989898" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/lee989898">lee989898</a></h4>
                                
                                    <p><a href="https://github.com/lee989898">깃허브</a></p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/lee989898">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            var this_page_url = 'https://lee989898.github.io/st-03';
                            var this_page_identifier = '/st-03';
                            var this_page_title = 'File IO';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://xxxxxxxx.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/built/images/blog-cover1.png)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; LEE &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/system/">System</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/st-10">POSIX Thread Programming</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/st-09">프로세스통신-socket</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/st-08">프로세스통신-pipe</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/system/">
                                
                                    See all 9 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/sc-03">
                <div class="post-card-image" style="background-image: url(/assets/built/images/security-logo.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/sc-03">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Security</span>
                            
                        
                    

                    <h2 class="post-card-title">Symmetric Key Cipher</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>Symmetric Key Cipher

</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/built/images/author-logo.jpg" alt="lee989898" />
                        
                        <span class="post-card-author">
                            <a href="/author/lee989898/">lee989898</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      2 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/algorithm-02">
                <div class="post-card-image" style="background-image: url(/assets/built/images/algorithm-logo.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/algorithm-02">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Algorithm</span>
                            
                        
                    

                    <h2 class="post-card-title">알고리즘의 효율성 분석</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>알고리즘 분석 체계

</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/built/images/author-logo.jpg" alt="lee989898" />
                        
                        <span class="post-card-author">
                            <a href="/author/lee989898/">lee989898</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://lee989898.github.io/">
            
            <span>LEE</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">File IO</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=File+IO&amp;url=https://lee989898.github.io/st-03"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://lee989898.github.io/st-03"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://lee989898.github.io/">LEE</a> &copy; 2022</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyllt/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
    <div id="subscribe" class="subscribe-overlay">
        <a class="subscribe-overlay-close" href="#"></a>
        <div class="subscribe-overlay-content">
            
            <h1 class="subscribe-overlay-title">Search LEE</h1>
            <p class="subscribe-overlay-description">
                lunr.js를 이용한 posts 검색 </p>
            <span id="searchform" method="post" action="/subscribe/" class="">
    <input class="confirm" type="hidden" name="confirm"  />
    <input class="location" type="hidden" name="location"  />
    <input class="referrer" type="hidden" name="referrer"  />

    <div class="form-group">
        <input class="subscribe-email" onkeyup="myFunc()"
               id="searchtext" type="text" name="searchtext"
               placeholder="Search..." />
    </div>
    <script type="text/javascript">
        function myFunc() {
            if(event.keyCode == 13) {
                var url = encodeURIComponent($("#searchtext").val());
                location.href = "/search.html?query=" + url;
            }
        }
    </script>
</span>
        </div>
    </div>
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-xxxxxxxx-x', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
